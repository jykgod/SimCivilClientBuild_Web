window.__require=function e(t,n,o){function i(s,c){if(!n[s]){if(!t[s]){var r=s.split("/");if(r=r[r.length-1],!t[r]){var l="function"==typeof __require&&__require;if(!c&&l)return l(r,!0);if(a)return a(r,!0);throw new Error("Cannot find module '"+s+"'")}}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){return i(t[s][1][e]||e)},u,u.exports,e,t,n,o)}return n[s].exports}for(var a="function"==typeof __require&&__require,s=0;s<o.length;s++)i(o[s]);return i}({CameraSystem:[function(e,t,n){"use strict";cc._RF.push(t,"8bdf2/vQ7dP+YutUYBHE+l8","CameraSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../manager/ResourcesManager"),i=e("../../tools/GloableConstantUtils"),a=e("../sharedComponent/MapDataComponent"),s=e("../component/MotionControllerComponent"),c=e("../component/PositionComponent"),r=e("../utility/EcsUtility"),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.OnStart=function(){o.ResourcesManager.Instance.loadRes(i.GloableConstantUtils.GamePrefabPath.concat("GameCamera"),function(e,t){if(e)Logger.log(e.message);else{var n=cc.instantiate(t);n.setParent(cc.Canvas.instance.node),a.default.instance.cameraNode=n}})},t.prototype.OnDestroy=function(){a.default.instance.cameraNode.destroy(),a.default.instance.cameraNode=null},t.prototype.OnUpdate=function(){if(!(this.positions.length<=0)){for(var e=cc.Vec2.ZERO,t=0;t<this.positions.length;t++)e.addSelf(this.positions[t].position);e.divSelf(this.positions.length);var n=e.clone();n.subSelf(a.default.instance.centerPosition);var o=n.mag();o*r.EcsUtility.LogicToUIRatio>100&&(n.mulSelf(100/(o*r.EcsUtility.LogicToUIRatio)),(n=e.sub(n))!=a.default.instance.centerPosition&&(a.default.instance.centerPositionDirty=!0,a.default.instance.centerPosition=n,a.default.instance.cameraNode.position=a.default.instance.centerPosition.mul(r.EcsUtility.LogicToUIRatio)))}},__decorate([ECS.inject(s.default)],t.prototype,"motionControllers",void 0),__decorate([ECS.inject(c.default)],t.prototype,"positions",void 0),t}(ECS.ComponentSystem);n.default=l,cc._RF.pop()},{"../../manager/ResourcesManager":"ResourcesManager","../../tools/GloableConstantUtils":"GloableConstantUtils","../component/MotionControllerComponent":"MotionControllerComponent","../component/PositionComponent":"PositionComponent","../sharedComponent/MapDataComponent":"MapDataComponent","../utility/EcsUtility":"EcsUtility"}],ComponentUINameEnum:[function(e,t,n){"use strict";cc._RF.push(t,"332f06PDuVG26fK59TkzYJh","ComponentUINameEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.DEFAULT="null"}(n.ComponentUINameEnum||(n.ComponentUINameEnum={})),cc._RF.pop()},{}],DirectionComponent:[function(e,t,n){"use strict";cc._RF.push(t,"f778co7FtJBeqazeMWh3kpa","DirectionComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){this.direction=cc.Vec2.ZERO}}();n.default=o,cc._RF.pop()},{}],EcsUtility:[function(e,t,n){"use strict";cc._RF.push(t,"636d21fNKdHlq7iso7mbvFV","EcsUtility"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){}return e.GotRole=!1,e.LogicToUIRatio=80,e}();n.EcsUtility=o,cc._RF.pop()},{}],EditableComponentContainerConfigure:[function(e,t,n){"use strict";cc._RF.push(t,"b6c12wK4RdBho+MBlw+ti3X","EditableComponentContainerConfigure"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(LocalStorageBase);n.EditableComponentContainerConfigure=o,cc._RF.pop()},{}],EditableComponentContainer:[function(e,t,n){"use strict";cc._RF.push(t,"6351fzF651AKa2GbH5Wc4/J","EditableComponentContainer"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./EditableComponentContainerConfigure"),i=e("../../enum/ComponentUINameEnum"),a=e("../UIBase"),s=e("../../enum/LocalStorageEnum"),c=e("../../manager/EditableComponentUIManager"),r=cc._decorator,l=r.ccclass,u=r.property,p=r.requireComponent,d=r.disallowMultiple,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.editableComponentUIArr=[],t.subUIArr=[],t}return __extends(t,e),t.prototype.start=function(){var e=this;Logger.log("start","EditableComponentUIContainer"),this.release(),this.subUIArr=[];this.node.getComponent(a.default);if(this.conf=LocalStorageUtils.loadStorageObject(s.LocalStorageEnum.EDITABLE_CONTAINER_PREFIX.concat(this.node.name)),null==this.conf){this.conf=new o.EditableComponentContainerConfigure(s.LocalStorageEnum.EDITABLE_CONTAINER_PREFIX.concat(this.node.name)),this.conf.keys=[],Logger.log(this.node.name+" \u672c\u5730\u914d\u7f6e\u8bfb\u53d6\u5931\u8d25\uff0c\u7528prefab\u4e0a\u7684\u914d\u7f6e\u521b\u5efa\u5b50UI","EditableComponentUIContainer");for(var t=0;t<this.editableComponentUIArr.length;t++)c.EditableComponentUIManager.Instance.CreateEditableComponentUI(this.node.name,this.editableComponentUIArr[t].fatherNode,this.editableComponentUIArr[t].name,function(t){e.subUIArr.push(t),e.conf.keys.push(t.Key),e.conf.keys.length==e.editableComponentUIArr.length&&e.conf.Save()})}else{Logger.log(this.node.name+" \u4f7f\u7528\u672c\u5730\u914d\u7f6e\u521b\u5efa\u5b50UI","EditableComponentUIContainer"),Logger.info(this.conf);for(t=0;t<this.conf.keys.length;t++)c.EditableComponentUIManager.Instance.LoadEditableComponentUI(this.conf.keys[t],function(t){e.subUIArr.push(t)})}},t.prototype.addSubUI=function(e){null!=this.conf&&void 0!=this.conf&&(this.subUIArr.push(e),this.conf.keys.push(e.Key),this.conf.Save())},t.prototype.release=function(){if(null!=this.subUIArr)for(var e=0;e<this.subUIArr.length;e++)this.subUIArr[e].node.destroy()},t.prototype.onDestroy=function(){this.release()},__decorate([u([cc.Class({name:"ComponentUIStruct",properties:{name:{default:i.ComponentUINameEnum.DEFAULT,tooltip:"\u53ef\u7f16\u8f91\u7ec4\u4ef6UI\u7684\u540d\u5b57\uff08\u4eceComponentUINameEnum\u91cc\u9762\u53d6\uff09"},fatherNode:{type:cc.Node,default:null,tooltip:"\u53ef\u7f16\u8f91\u7ec4\u4ef6UI\u9700\u8981\u6302\u8f7d\u7684\u8282\u70b9"}}})])],t.prototype,"editableComponentUIArr",void 0),t=__decorate([l,d,p(a.default)],t)}(cc.Component);n.EditableComponentUIContainer=m,cc._RF.pop()},{"../../enum/ComponentUINameEnum":"ComponentUINameEnum","../../enum/LocalStorageEnum":"LocalStorageEnum","../../manager/EditableComponentUIManager":"EditableComponentUIManager","../UIBase":"UIBase","./EditableComponentContainerConfigure":"EditableComponentContainerConfigure"}],EditableComponentUIConfigure:[function(e,t,n){"use strict";cc._RF.push(t,"589daM8EFRMf7RBbyU0L0ec","EditableComponentUIConfigure"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.clone=function(e){var n=new t(e);return n.uiname=this.uiname,n.pos=this.pos,n.scale=this.scale,n.fatherUI=this.fatherUI,n.parentNodePath=this.parentNodePath,n.data=this.data,n},t}(LocalStorageBase);n.EditableComponentUIConfigure=o,cc._RF.pop()},{}],EditableComponentUIManager:[function(e,t,n){"use strict";cc._RF.push(t,"60b19feBENPIpkRA31jhPVx","EditableComponentUIManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../ui/editableui/EditableComponentUI"),i=e("../ui/editableui/EditableComponentUIConfigure"),a=e("../tools/GloableConstantUtils"),s=e("../enum/LocalStorageEnum"),c=e("./UIManager"),r=e("../tools/GloableUtils"),l=function(){function e(){}return e.prototype.LoadEditableComponentUI=function(e,t){var n=LocalStorageUtils.loadStorageObject(e);Logger.info(n),cc.loader.loadRes(a.GloableConstantUtils.UIPrefabPath.concat(n.uiname.toString()),function(i,a){if(null!=i)return Logger.error("load res error key:"+e,"EditableComponent"),void(null!=t&&t(null));var s=cc.instantiate(a).getComponent(o.EditableComponentUI);s.Conf=n,1==s.resetUIStateByConfig()?(s.show(n.data),t(s)):(s.node.destroy(),null!=t&&t(null))})},e.prototype.CreateEditableComponentUI=function(e,t,n,l){var u=c.UIManager.Instance.GetUI(e);if(null==u||void 0==u)return Logger.log("\u7236UI\u4e3a\u7a7a","CreateEditableComponentUI "+e+" "+t+" "+n),void(null!=l&&l(null));var p=r.GloableUtils.GetNodePath(u.node,t);if(null==p)return Logger.log("\u627e\u4e0d\u5230\u7236\u8282\u70b9","CreateEditableComponentUI"),void(null!=l&&l(null));cc.loader.loadRes(a.GloableConstantUtils.UIPrefabPath.concat(n.toString()),function(a,c){if(null!=a)return Logger.error("load res error key:"+n,"EditableComponent"),void(null!=l&&l(null));var r=cc.instantiate(c),u=r.getComponent(o.EditableComponentUI);r.parent=t;var d=LocalStorageUtils.getNumber(s.LocalStorageEnum.EDITABLE_UI_COUNT)+1;LocalStorageUtils.setNumber(s.LocalStorageEnum.EDITABLE_UI_COUNT,d);var m=new i.EditableComponentUIConfigure(s.LocalStorageEnum.EDITABLE_UI_PREFIX.concat(d.toString()));m.fatherUI=e,m.parentNodePath=p,m.pos=r.position,m.scale=r.scale,m.uiname=n,m.Save(),u.Conf=m,u.show(null),null!=l&&l(u)})},e.Instance=new e,e}();n.EditableComponentUIManager=l,cc._RF.pop()},{"../enum/LocalStorageEnum":"LocalStorageEnum","../tools/GloableConstantUtils":"GloableConstantUtils","../tools/GloableUtils":"GloableUtils","../ui/editableui/EditableComponentUI":"EditableComponentUI","../ui/editableui/EditableComponentUIConfigure":"EditableComponentUIConfigure","./UIManager":"UIManager"}],EditableComponentUI:[function(e,t,n){"use strict";cc._RF.push(t,"c1d72LimzlFrqEaNAIwlTzE","EditableComponentUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../tools/GloableUtils"),i=e("../../enum/UINameEnum"),a=e("./EditableComponentUIConfigure"),s=e("../../enum/LocalStorageEnum"),c=e("../../manager/UIManager"),r=e("../../manager/EditableComponentUIManager"),l=e("../../tools/GloableConstantUtils"),u=e("./EditableComponentContainer"),p=cc._decorator,d=p.ccclass,m=(p.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pressEnterEditModeDeltaTime=1,t}return __extends(t,e),Object.defineProperty(t.prototype,"Key",{get:function(){return null==this.conf?null:this.conf.Key()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Editing",{get:function(){return this.editing},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){var e=this;Logger.log("onload","EditableComponentUI"),this.clickTimes=0,this.onPressing=!1,this.editing=!1,this.lastOnPressTimes=0;var t=this.node.getBoundingBoxToWorld();this.node.width=t.width,this.node.height=t.height,this.node.on(cc.Node.EventType.TOUCH_START,function(t){e.onPressEditCallBack(t)}),this.node.on(cc.Node.EventType.TOUCH_END,function(t){e.onReleaseEditCallBack(t)}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){e.onMoveEditCallBack(t)})},t.prototype.onPressEditCallBack=function(e){0==this.editing?this.onPressNotEditing(e):this.onPressEditing(e),this.lastOnPressTimes=TimeManager.Instance.realTimeSinceStartScene,this.onPressing=!0},t.prototype.onMoveEditCallBack=function(e){0==this.editing?this.onMoveNotEditing(e):this.onMoveEditing(e)},t.prototype.onReleaseEditCallBack=function(e){0==this.editing?this.onReleaseNotEditing(e):this.onReleaseEditing(e),this.onPressing=!1},t.prototype.onPressEditing=function(e){Logger.log("onPressEditing","EditableComponentUI")},t.prototype.onReleaseEditing=function(e){Logger.log("onReleaseEditing","EditableComponentUI")},t.prototype.onMoveEditing=function(e){1==this.onPressing&&(Logger.log("onMoveEditing","EditableComponentUI"),this.node.position=this.node.position.add(e.getDelta()))},t.prototype.onPressNotEditing=function(e){Logger.log("onPressNotEditing","EditableComponentUI")},t.prototype.onReleaseNotEditing=function(e){Logger.log("onReleaseNotEditing","EditableComponentUI")},t.prototype.onMoveNotEditing=function(e){Logger.log("onMoveNotEditing","EditableComponentUI")},t.prototype.update=function(){var e=this;0==this.editing&&1==this.onPressing&&TimeManager.Instance.realTimeSinceStartScene-this.lastOnPressTimes>this.pressEnterEditModeDeltaTime&&(this.onPressing=!1,null==this.editUI||void 0==this.editUI?cc.loader.loadRes(l.GloableConstantUtils.UIPrefabPath.concat(i.UINameEnum.EDITE_UI),function(t,n){if(null==t){e.editing=!0,e.editUI=cc.instantiate(n),e.editUI.width=e.node.width,e.editUI.height=e.node.height,e.editUI.parent=e.node;var o=e.editUI.getChildByName("Layout"),i=new cc.Component.EventHandler;i.target=e.node,i.component="EditableComponentUI",i.handler="save",o.getChildByName("ok").getComponent(cc.Button).clickEvents.push(i),(i=new cc.Component.EventHandler).target=e.node,i.component="EditableComponentUI",i.handler="cancel",o.getChildByName("cancel").getComponent(cc.Button).clickEvents.push(i),(i=new cc.Component.EventHandler).target=e.node,i.component="EditableComponentUI",i.handler="copy",o.getChildByName("add").getComponent(cc.Button).clickEvents.push(i)}else e.editing=!1}):(this.editing=!0,this.editUI.active=!0))},t.prototype.cancel=function(){this.resetUIStateByConfig(),this.editing=!1,null!=this.editUI&&void 0!=this.editUI&&(this.editUI.active=!1)},t.prototype.copy=function(){var e=this;this.clone(function(t){if(e.editing=!1,null!=e.editUI&&void 0!=e.editUI&&null!=e.fatherUI&&void 0!=e.fatherUI){var n=e.fatherUI.node.getComponent(u.EditableComponentUIContainer);e.editUI.active=!1,n.addSubUI(t)}})},t.prototype.save=function(){if(null!=this.editUI&&void 0!=this.editUI&&(this.editUI.active=!1),this.editing=!1,null!=this.fatherUI&&void 0!=this.fatherUI){c.UIManager.Instance.GetUI(this.conf.fatherUI);this.conf.parentNodePath=o.GloableUtils.GetNodePath(this.fatherUI.node,this.node.parent),this.conf.scale=this.node.scale,this.conf.pos=this.node.position,Logger.info(this.conf),this.conf.Save()}},t.prototype.clone=function(e){var t=LocalStorageUtils.getNumber(s.LocalStorageEnum.EDITABLE_UI_COUNT)+1;LocalStorageUtils.setNumber(s.LocalStorageEnum.EDITABLE_UI_COUNT,t);var n=this.conf.clone(s.LocalStorageEnum.EDITABLE_UI_PREFIX.concat(t.toString()));Logger.info(n),n.pos=n.pos.add(cc.Vec2.RIGHT.mul(this.node.width)),n.Save(),r.EditableComponentUIManager.Instance.LoadEditableComponentUI(n.Key(),e)},t.prototype.resetUIStateByConfig=function(){return this.fatherUI=c.UIManager.Instance.GetUI(this.conf.fatherUI),null!=this.fatherUI&&void 0!=this.fatherUI&&(this.node.parent=cc.find(this.conf.parentNodePath,this.fatherUI.node),this.node.scale=this.conf.scale,this.node.position=this.conf.pos,Logger.info(this.node),!0)},Object.defineProperty(t.prototype,"Conf",{set:function(e){this.conf=e,null!=e&&void 0!=e&&(this.conf.pos=cc.v2(this.conf.pos.x,this.conf.pos.y),this.conf.clone=a.EditableComponentUIConfigure.prototype.clone)},enumerable:!0,configurable:!0}),t.prototype.show=function(e){},t.prototype.delate=function(){},t.prototype.hide=function(){},t=__decorate([d],t)}(cc.Component));n.EditableComponentUI=m,cc._RF.pop()},{"../../enum/LocalStorageEnum":"LocalStorageEnum","../../enum/UINameEnum":"UINameEnum","../../manager/EditableComponentUIManager":"EditableComponentUIManager","../../manager/UIManager":"UIManager","../../tools/GloableConstantUtils":"GloableConstantUtils","../../tools/GloableUtils":"GloableUtils","./EditableComponentContainer":"EditableComponentContainer","./EditableComponentUIConfigure":"EditableComponentUIConfigure"}],EventEnum:[function(e,t,n){"use strict";cc._RF.push(t,"f9d47tY1oBC/py/nFzmYrXY","EventEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.GameSceneLoadingProgress="0",e.RefreshLocalizationText="1"}(n.EventEnum||(n.EventEnum={})),cc._RF.pop()},{}],GameLauncher:[function(e,t,n){"use strict";cc._RF.push(t,"0b8dfG8JZ1CZKnBYQPSA01v","GameLauncher"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../manager/GameManager"),i=e("../manager/UIManager"),a=e("../manager/LocalizationManager"),s=e("../manager/ResourcesManager"),c=cc._decorator,r=c.ccclass,l=(c.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return __extends(t,e),n=t,Object.defineProperty(t,"Instance",{get:function(){return this.instance},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){n.instance=this,cc.game.addPersistRootNode(this.node),s.ResourcesManager.Instance.Init(),TimeManager.Instance.Init(),a.LocalizationManager.Instance.Init("cn"),i.UIManager.Instance.Init(),o.GameManager.Instance.Init()},t.prototype.update=function(e){TimeManager.Instance.Update(e),o.GameManager.Instance.Update(e),null!=ECS.World.active&&void 0!=ECS.World.active&&ECS.World.active.update()},t.prototype.onDestroy=function(){},t.prototype.setScreenFit=function(){},t.instance=null,t=n=__decorate([r],t)}(cc.Component));n.default=l,cc._RF.pop()},{"../manager/GameManager":"GameManager","../manager/LocalizationManager":"LocalizationManager","../manager/ResourcesManager":"ResourcesManager","../manager/UIManager":"UIManager"}],GameManager:[function(e,t,n){"use strict";cc._RF.push(t,"06411YLVhtDQ5LQkf2swjkJ","GameManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../fsm/gameState/GameStateLogin"),i=e("../fsm/gameState/GameStateSceneLoading"),a=e("../enum/StateEnum"),s=e("../fsm/gameState/GameStateMainNormal"),c=function(){function e(){}return e.prototype.Init=function(){this.stateMachine=FSM.StateMachine.GetBuilder().AddState(new o.GameStateLogin).AddState(new i.GameStateSceneLoading).AddState(new s.GameStateMainNormal).build(),this.stateMachine.ChangeState(a.GameStateEnum.GAME_STATE_LOGIN)},e.prototype.Update=function(e){this.stateMachine.Update()},e.Instance=new e,e}();n.GameManager=c,cc._RF.pop()},{"../enum/StateEnum":"StateEnum","../fsm/gameState/GameStateLogin":"GameStateLogin","../fsm/gameState/GameStateMainNormal":"GameStateMainNormal","../fsm/gameState/GameStateSceneLoading":"GameStateSceneLoading"}],GameStateLogin:[function(e,t,n){"use strict";cc._RF.push(t,"9248bedY4hBY5qH+oMjI0Jz","GameStateLogin"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../enum/StateEnum"),i=e("../../manager/UIManager"),a=e("../../enum/UINameEnum"),s=function(){function e(){this.stateType=o.GameStateEnum.GAME_STATE_LOGIN}return e.prototype.StateEnter=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Logger.log("state login","GameStateLogin"),i.UIManager.Instance.ShowUI(a.UINameEnum.LOGIN_UI)},e.prototype.StateEnd=function(e){i.UIManager.Instance.HideUI(a.UINameEnum.LOGIN_UI)},e}();n.GameStateLogin=s,cc._RF.pop()},{"../../enum/StateEnum":"StateEnum","../../enum/UINameEnum":"UINameEnum","../../manager/UIManager":"UIManager"}],GameStateMainNormal:[function(e,t,n){"use strict";cc._RF.push(t,"db97e4xE5VO07XQxyKMmVyi","GameStateMainNormal"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../enum/StateEnum"),i=e("../../manager/UIManager"),a=e("../../enum/UINameEnum"),s=e("../../ecs/system/InputSystem"),c=e("../../ecs/system/MapSystem"),r=e("../../ecs/system/ViewSyncSystem"),l=e("../../ecs/system/MotionControllerSystem"),u=e("../../ecs/system/PlayerMotionSyncSystem"),p=e("../../ecs/system/RoleSystem"),d=e("../../ecs/system/CameraSystem"),m=function(){function e(){this.stateType=o.GameStateEnum.GAME_STATE_MAIN_NORMAL}return e.prototype.StateEnter=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];i.UIManager.Instance.ShowUI(a.UINameEnum.MAIN_UI),this.world=ECS.World.CreateAWorld("simsivil"),this.world.addSystem(p.default),this.world.addSystem(s.default),this.world.addSystem(c.default),this.world.addSystem(d.default),this.world.addSystem(r.default),this.world.addSystem(l.default),this.world.addSystem(u.default)},e.prototype.StateUpdate=function(e){},e.prototype.StateEnd=function(e){i.UIManager.Instance.HideUI(a.UINameEnum.MAIN_UI),ECS.World.RemoveWorld("simsivil"),this.world=null},e}();n.GameStateMainNormal=m,cc._RF.pop()},{"../../ecs/system/CameraSystem":"CameraSystem","../../ecs/system/InputSystem":"InputSystem","../../ecs/system/MapSystem":"MapSystem","../../ecs/system/MotionControllerSystem":"MotionControllerSystem","../../ecs/system/PlayerMotionSyncSystem":"PlayerMotionSyncSystem","../../ecs/system/RoleSystem":"RoleSystem","../../ecs/system/ViewSyncSystem":"ViewSyncSystem","../../enum/StateEnum":"StateEnum","../../enum/UINameEnum":"UINameEnum","../../manager/UIManager":"UIManager"}],GameStateSceneLoading:[function(e,t,n){"use strict";cc._RF.push(t,"5bbf6SuyHVKSL+l93+spA1c","GameStateSceneLoading"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../enum/StateEnum"),i=e("../../manager/UIManager"),a=e("../../enum/UINameEnum"),s=e("../../logic/GameLauncher"),c=e("../../enum/EventEnum"),r=e("../../manager/GameManager"),l=function(){function e(){this.stateType=o.GameStateEnum.GAME_STATE_SCENE_LOADING}return e.prototype.StateEnter=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];i.UIManager.Instance.ShowUI(a.UINameEnum.LOADING_UI),cc.director.loadScene(e,function(){var e;(e=r.GameManager.Instance.stateMachine).ChangeState.apply(e,[t].concat(n))})},e.prototype.StateUpdate=function(e){s.default.Instance.node.emit(c.EventEnum.GameSceneLoadingProgress,e)},e.prototype.StateEnd=function(e){i.UIManager.Instance.HideUI(a.UINameEnum.LOADING_UI)},e}();n.GameStateSceneLoading=l,cc._RF.pop()},{"../../enum/EventEnum":"EventEnum","../../enum/StateEnum":"StateEnum","../../enum/UINameEnum":"UINameEnum","../../logic/GameLauncher":"GameLauncher","../../manager/GameManager":"GameManager","../../manager/UIManager":"UIManager"}],GloableConstantUtils:[function(e,t,n){"use strict";cc._RF.push(t,"fdba0DRkoBLcKywyb9dWZSz","GloableConstantUtils"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){}return e.UIPrefabPath="prefab/ui/",e.TestPrefabPath="prefab/test/",e.GamePrefabPath="prefab/game/",e.AtlasPath="image/atlas/",e.JsonPath="json/",e.mapZIndex=-1e3,e}();n.GloableConstantUtils=o,cc._RF.pop()},{}],GloableUtils:[function(e,t,n){"use strict";cc._RF.push(t,"0008ew41hJGPJOX3QUVe7Mw","GloableUtils"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../manager/UIManager"),i=e("../enum/UINameEnum"),a=e("./JsonConfigUtils"),s=function(){return function(e,t,n){this.content=e,this.okCallBack=t,this.cancelCallBack=n}}(),c=function(){function e(){}return e.ShowTips=function(t,n,o){void 0===n&&(n=null),void 0===o&&(o=null),null==e.tipsPendingQueue&&(e.tipsPendingQueue=new Tools.Queue),e.tipsPendingQueue.Enqueue(new s(t,n,o)),1==e.tipsPendingQueue.count&&e.RealShowTips()},e.RealShowTips=function(){var t=e.tipsPendingQueue.first;o.UIManager.Instance.ShowUI(i.UINameEnum.POP_UP_WARNING_UI,function(n,o){null==n?(Logger.log("show tips,content:"+t.content,"TIP"),o.text.string=t.content):e.tipsPendingQueue.Dequeue()})},e.TipsOnclickOk=function(){var t=e.tipsPendingQueue.Dequeue();null!=t.okCallBack&&t.okCallBack(),Logger.log("click ok,content:"+t.content,"TIP"),0==e.tipsPendingQueue.count?o.UIManager.Instance.HideUI(i.UINameEnum.POP_UP_WARNING_UI):e.RealShowTips()},e.TipsOnclickCancel=function(){var t=e.tipsPendingQueue.Dequeue();null!=t.cancelCallBack&&t.cancelCallBack(),Logger.log("click cancel,content:"+t.content,"TIP"),0==e.tipsPendingQueue.count?o.UIManager.Instance.HideUI(i.UINameEnum.POP_UP_WARNING_UI):e.RealShowTips()},e.GetNodePath=function(e,t){for(var n=null;null!=t&&void 0!=t&&e!=t;)n=null!=n?t.name.concat("/".concat(n)):t.name,t=t.parent;return n},e.Delay=function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})},e.prototype.GetAtalasAndCeilName=function(e,t,n,o){a.JsonConigUtils.ReadJsonObjectByName("MapAtlasNameConfig",function(i,a){if(i)Logger.error(i,"GetAtalasAndCeilName");else if(a=a[e.toString()]){if(e==t)a=a[0],t=a[0].other_type;else{for(var s=!1,c=0;c<a.length;c++)if(a[c].other_type==t){a=a[c],s=!0;break}if(0==s)return void Logger.error("\u627e\u4e0d\u5230\u5730\u5f62"+e+"\u5728\u5468\u56f4\u5730\u5f62\u4e3a"+t+"\u7684\u60c5\u51b5\u4e0b\u6240\u5bf9\u5e94\u7684\u56fe\u96c6\u914d\u7f6e","GetAtalasAndCeilName")}var r={};r.atlas=a.atals,r.id=e>t?(255&n).toString():n.toString(),o&&o(r)}else Logger.error("\u627e\u4e0d\u5230\u5730\u5f62"+e+"\u5bf9\u5e94\u7684\u56fe\u96c6\u914d\u7f6e","GetAtalasAndCeilName")})},e.GetMaskString=function(e){for(var t="",n=7;n>=0;n--)t+=(e&1<<n)>0?"1":"0";return t},e.tipsPendingQueue=null,e.dx=[-1,0,1,-1,1,-1,0,1],e.dy=[1,1,1,0,0,-1,-1,-1],e}();n.GloableUtils=c,cc._RF.pop()},{"../enum/UINameEnum":"UINameEnum","../manager/UIManager":"UIManager","./JsonConfigUtils":"JsonConfigUtils"}],GraphicComponent:[function(e,t,n){"use strict";cc._RF.push(t,"98665umGAxLYLGtM9VSFcOT","GraphicComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],InputData:[function(e,t,n){"use strict";cc._RF.push(t,"e2003rIYB9FkI6d5OKdWKjm","InputData"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],InputSystem:[function(e,t,n){"use strict";cc._RF.push(t,"5c52fc6VXJIoKuiK/MtVC8y","InputSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../sharedComponent/InputData"),i=e("../../logic/GameLauncher"),a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.OnStart=function(){ECS.World.active.EntitisManager.addSharedComponent(o.default),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),i.default.Instance.node.on(cc.Node.EventType.MOUSE_DOWN,this.onMouseDown,this),i.default.Instance.node.on(cc.Node.EventType.MOUSE_UP,this.onMouseUp,this),i.default.Instance.node.on(cc.Node.EventType.MOUSE_MOVE,this.onMouseMove,this)},t.prototype.OnDestroy=function(){ECS.World.active.EntitisManager.removeSharedComponent(o.default),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),i.default.Instance.node.off(cc.Node.EventType.MOUSE_DOWN,this.onMouseDown,this),i.default.Instance.node.off(cc.Node.EventType.MOUSE_UP,this.onMouseUp,this),i.default.Instance.node.off(cc.Node.EventType.MOUSE_MOVE,this.onMouseMove,this)},t.prototype.OnUpdate=function(){},t.prototype.onMouseDown=function(e){switch(e.getButton()){case cc.Event.EventMouse.BUTTON_LEFT:o.default.instance.mouse_left=!0;break;case cc.Event.EventMouse.BUTTON_RIGHT:o.default.instance.mouse_right=!0}o.default.instance.mousePosition=e.getLocation(),o.default.instance.time=TimeManager.Instance.realTimeSinceStartScene},t.prototype.onMouseUp=function(e){switch(e.getButton()){case cc.Event.EventMouse.BUTTON_LEFT:o.default.instance.mouse_left=!1;break;case cc.Event.EventMouse.BUTTON_RIGHT:o.default.instance.mouse_right=!1}o.default.instance.mousePosition=e.getLocation(),o.default.instance.time=TimeManager.Instance.realTimeSinceStartScene},t.prototype.onMouseMove=function(e){o.default.instance.mousePosition=e.getLocation(),o.default.instance.time=TimeManager.Instance.realTimeSinceStartScene},t.prototype.onKeyDown=function(e){switch(e.keyCode){case cc.macro.KEY.w:o.default.instance.up=!0;break;case cc.macro.KEY.a:o.default.instance.left=!0;break;case cc.macro.KEY.s:o.default.instance.down=!0;break;case cc.macro.KEY.d:o.default.instance.right=!0}o.default.instance.time=TimeManager.Instance.realTimeSinceStartScene},t.prototype.onKeyUp=function(e){switch(e.keyCode){case cc.macro.KEY.w:o.default.instance.up=!1;break;case cc.macro.KEY.a:o.default.instance.left=!1;break;case cc.macro.KEY.s:o.default.instance.down=!1;break;case cc.macro.KEY.d:o.default.instance.right=!1}o.default.instance.time=TimeManager.Instance.realTimeSinceStartScene},t}(ECS.ComponentSystem);n.default=a,cc._RF.pop()},{"../../logic/GameLauncher":"GameLauncher","../sharedComponent/InputData":"InputData"}],JsonConfigNameEnum:[function(e,t,n){"use strict";cc._RF.push(t,"836b4zYSEVOUaT+cLzaxwya","JsonConfigNameEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.Language_CN="cn",e.Language_EN="en",e.Client_Config="ClientConfig",e.Map_Atlas_Name="MapAtlasNameConfig"}(n.JsonConfigNameEnum||(n.JsonConfigNameEnum={})),cc._RF.pop()},{}],JsonConfigUtils:[function(e,t,n){"use strict";cc._RF.push(t,"d169eVRYu1CeJ93bkuNsFEU","JsonConfigUtils"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./GloableConstantUtils"),i=function(){function e(){}return e.ReadJsonObjectByPath=function(t,n){void 0==e.jsonObjectDict[t]||null==e.jsonObjectDict[t]?cc.loader.loadRes(t,cc.TextAsset,function(o,i){e.jsonObjectDict[t]=i.json,n(o,i.json)}):n(null,e.jsonObjectDict[t])},e.ReadJsonObjectByName=function(t,n){void 0==e.jsonObjectDict[t]||null==e.jsonObjectDict[t]?cc.loader.loadRes(o.GloableConstantUtils.JsonPath.concat(t),function(o,i){e.jsonObjectDict[t]=i.json,n(o,i.json)}):n(null,e.jsonObjectDict[t])},e.jsonObjectDict=new Array,e}();n.JsonConigUtils=i,cc._RF.pop()},{"./GloableConstantUtils":"GloableConstantUtils"}],LoadingUI:[function(e,t,n){"use strict";cc._RF.push(t,"dfed1kFWuBIwoqRmUrmL7ji","LoadingUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../UIBase"),i=cc._decorator,a=i.ccclass,s=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.hide=function(){this.node.active=!1},t.prototype.show=function(){this.node.active=!0},t=__decorate([a],t)}(o.default));n.default=s,cc._RF.pop()},{"../UIBase":"UIBase"}],LocalStorageEnum:[function(e,t,n){"use strict";cc._RF.push(t,"b535bm3Iv9HQISVC6+5qfzw","LocalStorageEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.ACCOUNT_ID="0_",e.ACCOUNT_PASS_WORD="1_",e.EDITABLE_UI_COUNT="2_",e.EDITABLE_UI_PREFIX="3_",e.EDITABLE_CONTAINER_PREFIX="4_",e.ENABLE_LOG="5_"}(n.LocalStorageEnum||(n.LocalStorageEnum={})),cc._RF.pop()},{}],LocalizationManager:[function(e,t,n){"use strict";cc._RF.push(t,"d8adaY0EuFMuoQSGnlZT75n","LocalizationManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../logic/GameLauncher"),i=e("../enum/EventEnum"),a=e("../enum/JsonConfigNameEnum"),s=e("../tools/JsonConfigUtils"),c=function(){function e(){this.inited=!1}return e.prototype.Init=function(e){var t=this;e==a.JsonConfigNameEnum.Language_CN?this.languageCode=a.JsonConfigNameEnum.Language_CN:this.languageCode=a.JsonConfigNameEnum.Language_EN,this.inited=!1,s.JsonConigUtils.ReadJsonObjectByName(this.languageCode,function(e,n){null==e&&(t.localizationDictionary=n,t.inited=!0,o.default.Instance.node.emit(i.EventEnum.RefreshLocalizationText))})},e.prototype.GetLocalizationTextByKey=function(e){return 0==this.inited?"...":this.localizationDictionary[e]},e.prototype.GetLocalizationTextByKeyWithParams=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(0==this.inited)return"...";var o=this.localizationDictionary[e];if(void 0!=t)for(var i=0;i<t.length;i++)o=o.replace("{"+i+"}",t[i]);return o},e.Instance=new e,e}();n.LocalizationManager=c,cc._RF.pop()},{"../enum/EventEnum":"EventEnum","../enum/JsonConfigNameEnum":"JsonConfigNameEnum","../logic/GameLauncher":"GameLauncher","../tools/JsonConfigUtils":"JsonConfigUtils"}],LoginUI:[function(e,t,n){"use strict";cc._RF.push(t,"85fd6rKxWlKYahdSTo36AYb","LoginUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../UIBase"),i=e("../../manager/GameManager"),a=e("../../enum/StateEnum"),s=e("../../enum/SceneEnum"),c=e("../../manager/LocalizationManager"),r=e("../../enum/JsonConfigNameEnum"),l=e("../../tools/GloableUtils"),u=e("../../tools/JsonConfigUtils"),p=cc._decorator,d=p.ccclass,m=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.accountEditBox=null,t.passwrodEditBox=null,t.loginButton=null,t.registerButton=null,t.ipEditBox=null,t}return __extends(t,e),t.prototype.hide=function(){UIAnimationUtils.ScaleOut(this.node)},t.prototype.show=function(){var e=this;u.JsonConigUtils.ReadJsonObjectByName(r.JsonConfigNameEnum.Client_Config,function(t,n){UIAnimationUtils.ScaleIn(e.node),0==n.Test?e.ipEditBox.enabled=!1:e.ipEditBox.string=n.ServerIP})},t.prototype.onClickLogin=function(){var e=this;this.SetButtonEnable(!1),this.CheckIfConnectServer(function(){return e.onClickLogin()})&&SimCivil.Contract.IAuth.LogInAsync(this.accountEditBox.string,this.passwrodEditBox.string).then(function(t){e.SetButtonEnable(!0),null==t||0==t?l.GloableUtils.ShowTips(c.LocalizationManager.Instance.GetLocalizationTextByKey("login_text_tips_error")):i.GameManager.Instance.stateMachine.ChangeState(a.GameStateEnum.GAME_STATE_SCENE_LOADING,s.SceneEnum.MAIN,a.GameStateEnum.GAME_STATE_MAIN_NORMAL)})},t.prototype.onClickRegister=function(){var e=this;this.SetButtonEnable(!1),this.CheckIfConnectServer(function(){return e.onClickRegister()})&&SimCivil.Contract.IAuth.Register(this.accountEditBox.string,this.passwrodEditBox.string).then(function(t){e.SetButtonEnable(!0),null==t||0==t?l.GloableUtils.ShowTips(c.LocalizationManager.Instance.GetLocalizationTextByKey("register_text_tips_error")):l.GloableUtils.ShowTips(c.LocalizationManager.Instance.GetLocalizationTextByKey("register_text_tips_success"))})},t.prototype.SetButtonEnable=function(e){this.loginButton.interactable=e,this.registerButton.interactable=e},t.prototype.CheckIfConnectServer=function(e){var t=this;return null!=RpcClient.Instance.session&&0!=RpcClient.Instance.session.connected||(u.JsonConigUtils.ReadJsonObjectByName(r.JsonConfigNameEnum.Client_Config,function(n,o){null==n?1==o.OfflineMode?i.GameManager.Instance.stateMachine.ChangeState(a.GameStateEnum.GAME_STATE_SCENE_LOADING,s.SceneEnum.MAIN,a.GameStateEnum.GAME_STATE_MAIN_NORMAL):0==o.Test?RpcClient.Instance.Init(o.ServerIP,e):RpcClient.Instance.Init(t.ipEditBox.string,e):(t.SetButtonEnable(!0),l.GloableUtils.ShowTips(c.LocalizationManager.Instance.GetLocalizationTextByKey("connet_server_error")))}),!1)},__decorate([m(cc.EditBox)],t.prototype,"accountEditBox",void 0),__decorate([m(cc.EditBox)],t.prototype,"passwrodEditBox",void 0),__decorate([m(cc.Button)],t.prototype,"loginButton",void 0),__decorate([m(cc.Button)],t.prototype,"registerButton",void 0),__decorate([m(cc.EditBox)],t.prototype,"ipEditBox",void 0),t=__decorate([d],t)}(o.default);n.default=f,cc._RF.pop()},{"../../enum/JsonConfigNameEnum":"JsonConfigNameEnum","../../enum/SceneEnum":"SceneEnum","../../enum/StateEnum":"StateEnum","../../manager/GameManager":"GameManager","../../manager/LocalizationManager":"LocalizationManager","../../tools/GloableUtils":"GloableUtils","../../tools/JsonConfigUtils":"JsonConfigUtils","../UIBase":"UIBase"}],MainUIEquipComponent:[function(e,t,n){"use strict";cc._RF.push(t,"2bd90K8z/9P4rudxEL0I5HW","MainUIEquipComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../editableui/EditableComponentUI"),i=cc._decorator,a=i.ccclass,s=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.priRefresh=function(e){this.itemID=e},t.prototype.pubRefresh=function(e){this.itemID=e,this.conf.data={itemID:e},this.conf.Save()},t.prototype.show=function(e){var t=this;Logger.log("show","MainUIEquipComponent"),this.sprEquip=this.node.getChildByName("equip").getComponent(cc.Sprite),this.txtName=this.node.getChildByName("name").getComponent(cc.Label),null!=e&&(this.priRefresh(e.itemID),this.node.on(cc.Node.EventType.MOUSE_DOWN,function(){return t.onPressCallBack}))},t.prototype.onPressCallBack=function(){Logger.log("onPressCallBack","MainUIEquipComponent")},t=__decorate([a],t)}(o.EditableComponentUI));n.default=s,cc._RF.pop()},{"../editableui/EditableComponentUI":"EditableComponentUI"}],MainUI:[function(e,t,n){"use strict";cc._RF.push(t,"3adc0+9+IJOjbQA4CRFJiAk","MainUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../UIBase"),i=e("../../manager/UIManager"),a=cc._decorator,s=a.ccclass,c=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.topNode=null,t.bottomNode=null,t.topLeftNode=null,t.topRightNode=null,t.bottomLeftNode=null,t.bottomRightNode=null,t.centerNode=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.topNode.position=cc.Vec2.UP.mulSelf(i.UIManager.Instance.Canvas.node.height),this.bottomNode.position=cc.Vec2.UP.mulSelf(-i.UIManager.Instance.Canvas.node.height),this.topLeftNode.position=cc.Vec2.RIGHT.mulSelf(-i.UIManager.Instance.Canvas.node.width),this.topRightNode.position=cc.Vec2.RIGHT.mulSelf(i.UIManager.Instance.Canvas.node.width),this.bottomLeftNode.position=cc.Vec2.RIGHT.mulSelf(-i.UIManager.Instance.Canvas.node.width),this.bottomRightNode.position=cc.Vec2.RIGHT.mulSelf(i.UIManager.Instance.Canvas.node.width)},t.prototype.hide=function(){UIAnimationUtils.MoveOut(this.topNode,null,cc.Vec2.UP.mulSelf(i.UIManager.Instance.Canvas.node.height)),UIAnimationUtils.MoveOut(this.bottomNode,null,cc.Vec2.UP.mulSelf(-i.UIManager.Instance.Canvas.node.height)),UIAnimationUtils.MoveOut(this.topLeftNode,null,cc.Vec2.RIGHT.mulSelf(-i.UIManager.Instance.Canvas.node.width)),UIAnimationUtils.MoveOut(this.topRightNode,null,cc.Vec2.RIGHT.mulSelf(i.UIManager.Instance.Canvas.node.width)),UIAnimationUtils.MoveOut(this.bottomLeftNode,null,cc.Vec2.RIGHT.mulSelf(-i.UIManager.Instance.Canvas.node.width)),UIAnimationUtils.MoveOut(this.bottomRightNode,null,cc.Vec2.RIGHT.mulSelf(i.UIManager.Instance.Canvas.node.width)),UIAnimationUtils.ScaleOut(this.centerNode,null)},t.prototype.show=function(){UIAnimationUtils.MoveIn(this.topNode,null),UIAnimationUtils.MoveIn(this.bottomNode,null),UIAnimationUtils.MoveIn(this.topLeftNode,null),UIAnimationUtils.MoveIn(this.topRightNode,null),UIAnimationUtils.MoveIn(this.bottomLeftNode,null),UIAnimationUtils.MoveIn(this.bottomRightNode,null),UIAnimationUtils.ScaleIn(this.centerNode,null)},__decorate([c(cc.Node)],t.prototype,"topNode",void 0),__decorate([c(cc.Node)],t.prototype,"bottomNode",void 0),__decorate([c(cc.Node)],t.prototype,"topLeftNode",void 0),__decorate([c(cc.Node)],t.prototype,"topRightNode",void 0),__decorate([c(cc.Node)],t.prototype,"bottomLeftNode",void 0),__decorate([c(cc.Node)],t.prototype,"bottomRightNode",void 0),__decorate([c(cc.Node)],t.prototype,"centerNode",void 0),t=__decorate([s],t)}(o.default);n.default=r,cc._RF.pop()},{"../../manager/UIManager":"UIManager","../UIBase":"UIBase"}],MapCeilComponent:[function(e,t,n){"use strict";cc._RF.push(t,"1c23eHONW5FebVkWf+cH7oC","MapCeilComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],MapCeilTypEnum:[function(e,t,n){"use strict";cc._RF.push(t,"42ba58ILZVDnqCD/cZ8toK4","MapCeilTypEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.grass=0]="grass",e[e.path=1]="path",e[e.water=2]="water",e[e.end=3]="end"}(n.MapCeilTypeEnum||(n.MapCeilTypeEnum={})),cc._RF.pop()},{}],MapCeilUIComponent:[function(e,t,n){"use strict";cc._RF.push(t,"8c219KeSlBCSKdc1YGPJc40","MapCeilUIComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../tools/GloableUtils"),i=e("../../manager/ResourcesManager"),a=e("../../ecs/utility/EcsUtility"),s=cc._decorator,c=s.ccclass,r=s.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprites=[],t}return __extends(t,e),t.prototype.onLoad=function(){this.node.active=!1},t.prototype.update=function(e){var t=this;if(this.mapCeil.uiDirty){var n=this.mapCeil.ceil.Atlas;this.node.position=this.mapCeil.pos.mul(a.EcsUtility.LogicToUIRatio),null!=n&&(this.mapCeil.uiDirty=!1,i.ResourcesManager.Instance.loadAtlas(n,function(e,n){if(null==e)for(var i=t.mapCeil.ceil.Mask,a=0;a<i.length;a++)t.sprites[a].spriteFrame=n.getSpriteFrame(o.GloableUtils.GetMaskString(i[a]));else Logger.error(e,"MapCeilUIComponent")}))}},__decorate([r([cc.Sprite])],t.prototype,"sprites",void 0),t=__decorate([c],t)}(cc.Component);n.default=l,cc._RF.pop()},{"../../ecs/utility/EcsUtility":"EcsUtility","../../manager/ResourcesManager":"ResourcesManager","../../tools/GloableUtils":"GloableUtils"}],MapCeil:[function(e,t,n){"use strict";cc._RF.push(t,"470adiMN3VFt7gPVm2ObY65","MapCeil"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../tools/JsonConfigUtils"),i=e("../enum/JsonConfigNameEnum"),a=function(){function e(){this._type=-1,this._atlas=null}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Atlas",{get:function(){return this._atlas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Mask",{get:function(){return this._mask},enumerable:!0,configurable:!0}),e.prototype.Reset=function(e,t){var n=this;this._mask=[0,0,0,0];for(var a=0,s=e,c=0;c<t.length;c++)t[c]==e?a=1+(a<<1):(a<<=1,s=t[c]);if(this._type==e&&this.mask==a)return!1;if(this._type=e,this.mask=a,this._mask[0]=11+(128&a)+(64&a)+((64&a)>>1)+(16&a)+((16&a)>>2),this._mask[1]=22+((64&a)<<1)+(64&a)+(32&a)+(8&a)+((8&a)>>3),this._mask[2]=104+((16&a)<<3)+(16&a)+(4&a)+(2&a)+((2&a)>>1),this._mask[3]=208+((8&a)<<2)+(8&a)+((2&a)<<1)+(2&a)+(1&a),s<e)for(c=0;c<4;c++)this._mask[c]=255^this._mask[c];return o.JsonConigUtils.ReadJsonObjectByName(i.JsonConfigNameEnum.Map_Atlas_Name,function(t,o){for(var i=o[e.toString()],a=0;a<i.length;a++)if(i[a].other_type==s)return void(n._atlas=i[a].atlas);n._atlas=i[0].atlas}),!0},e}();n.default=a,cc._RF.pop()},{"../enum/JsonConfigNameEnum":"JsonConfigNameEnum","../tools/JsonConfigUtils":"JsonConfigUtils"}],MapDataComponent:[function(e,t,n){"use strict";cc._RF.push(t,"702a1HvRDFM6YZF1shcV/Jd","MapDataComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){this.centerPosition=cc.Vec2.ZERO,this.centerPositionDirty=!1,this.viewWidth=0,this.viewHeight=0,this.cacheWidth=50,this.cacheHeight=50,this.ceilsData=new Array,this.ceilsFromServer=new Array,this.mapCeilsInView=new Array,this.ceilsPosistionInied=!1}}();n.default=o,cc._RF.pop()},{}],MapSystem:[function(e,t,n){"use strict";cc._RF.push(t,"8bbffFETblAdIjUgquZHlvb","MapSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../sharedComponent/MapDataComponent"),i=e("../../struct/MapCeil"),a=e("../component/MapCeilComponent"),s=e("../../tools/GloableConstantUtils"),c=e("../../tools/GloableUtils"),r=e("../../manager/ResourcesManager"),l=e("../../logic/map/MapCeilUIComponent"),u=e("../utility/EcsUtility"),p=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.OnStart=function(){ECS.World.active.EntitisManager.addSharedComponent(o.default),o.default.instance.centerPositionDirty=!1,o.default.instance.viewWidth=Math.ceil(cc.Canvas.instance.node.width/u.EcsUtility.LogicToUIRatio),o.default.instance.viewHeight=Math.ceil(cc.Canvas.instance.node.height/u.EcsUtility.LogicToUIRatio),this.InitCeilsPosition()},t.prototype.OnDestroy=function(){ECS.World.active.EntitisManager.removeSharedComponent(o.default)},t.prototype.OnUpdate=function(){this.UpdateCeilsPosition(),this.DealServerData(),this.UpdateCeilsTexture()},t.prototype.DealServerData=function(){var e=o.default.instance.ceilsFromServer;if(e.length>0){for(var t=0;t<e.length;t++)o.default.instance.ceilsData[e[t].Position.Item1]||(o.default.instance.ceilsData[e[t].Position.Item1]=[]),o.default.instance.ceilsData[e[t].Position.Item1][e[t].Position.Item2]=e[t].Terrain;o.default.instance.ceilsFromServer=new Array}},t.prototype.InitCeilsPosition=function(){for(var e=o.default.instance.cacheWidth,t=o.default.instance.cacheHeight,n=ECS.World.active.EntitisManager,c=0;c<e;c++)for(var u=function(e){var t=n.CreateAEntity();n.addComponent(t,a.default);var o=n.GetComponent(t,a.default);o.pos=new cc.Vec2(c,e),o.ceil=new i.default,r.ResourcesManager.Instance.loadRes(s.GloableConstantUtils.GamePrefabPath.concat("Ceil"),function(e,t){var n=cc.instantiate(t);n.setParent(cc.Canvas.instance.node),n.zIndex=s.GloableConstantUtils.mapZIndex,n.getComponent(l.default).mapCeil=o,o.uiNode=n}),o.dirty=!0},p=0;p<t;p++)u(p);o.default.instance.ceilsPosistionInied=!0},t.prototype.UpdateCeilsPosition=function(){if(0!=o.default.instance.ceilsPosistionInied&&0!=o.default.instance.centerPositionDirty){for(var e=o.default.instance.cacheHeight,t=o.default.instance.cacheWidth,n=o.default.instance.centerPosition,i=n.y+e/2,a=n.y-e/2,s=n.x-t/2,c=n.x+t/2,r=n.y+o.default.instance.viewHeight/2+.5,l=n.y-o.default.instance.viewHeight/2-.5,u=n.x-o.default.instance.viewWidth/2-.5,p=n.x+o.default.instance.viewWidth/2+.5,d=(new Array,0);d<this.ceils.length;d++)this.ceils[d].pos.y>i&&(this.ceils[d].pos.y=a+(this.ceils[d].pos.y-i)%e,this.ceils[d].dirty=!0),this.ceils[d].pos.y<a&&(this.ceils[d].pos.y=i-(a-this.ceils[d].pos.y)%e,this.ceils[d].dirty=!0),this.ceils[d].pos.x>c&&(this.ceils[d].pos.x=s+(this.ceils[d].pos.x-c)%t,this.ceils[d].dirty=!0),this.ceils[d].pos.x<s&&(this.ceils[d].pos.x=c-(s-this.ceils[d].pos.x)%t,this.ceils[d].dirty=!0),1==this.ceils[d].dirty&&(this.ceils[d].inView=this.ceils[d].pos.x<p&&this.ceils[d].pos.x>u&&this.ceils[d].pos.y<r&&this.ceils[d].pos.y>l);o.default.instance.centerPositionDirty=!1}},t.prototype.UpdateCeilsTexture=function(){for(var e=0;e<this.ceils.length;e++)if(this.ceils[e].inView&&this.ceils[e].dirty){this.ceils[e].uiNode.active=!0;var t=Math.round(this.ceils[e].pos.x),n=Math.round(this.ceils[e].pos.y),i=0,a=[0,0,0,0,0,0,0,0];try{var s=o.default.instance.ceilsData;i=s[t][n];for(var r=0;r<8;r++)a[r]=s[t+c.GloableUtils.dx[r]][n+c.GloableUtils.dy[r]]}catch(e){Logger.info(e),Logger.error("\u5730\u5f62\u4fe1\u606f\u83b7\u53d6\u5931\u8d25\uff01("+t+", "+n+")","MAPSYS")}this.ceils[e].dirty=!1,this.ceils[e].uiDirty=this.ceils[e].ceil.Reset(i,a)}},__decorate([ECS.inject(a.default)],t.prototype,"ceils",void 0),t}(ECS.ComponentSystem);n.default=p,cc._RF.pop()},{"../../logic/map/MapCeilUIComponent":"MapCeilUIComponent","../../manager/ResourcesManager":"ResourcesManager","../../struct/MapCeil":"MapCeil","../../tools/GloableConstantUtils":"GloableConstantUtils","../../tools/GloableUtils":"GloableUtils","../component/MapCeilComponent":"MapCeilComponent","../sharedComponent/MapDataComponent":"MapDataComponent","../utility/EcsUtility":"EcsUtility"}],MotionComponent:[function(e,t,n){"use strict";cc._RF.push(t,"5bf6dBXUwJODael5B4XLnHS","MotionComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){this.speed=0,this.v=cc.Vec2.ZERO,this.canMove=!0}}();n.default=o,cc._RF.pop()},{}],MotionControllerComponent:[function(e,t,n){"use strict";cc._RF.push(t,"2399ficJ/ND6rAbOPK8mAYG","MotionControllerComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){this.type=0}}();n.default=o,cc._RF.pop()},{}],MotionControllerSystem:[function(e,t,n){"use strict";cc._RF.push(t,"cf442wmMO9PZLculpsZ+qy/","MotionControllerSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../component/MotionComponent"),i=e("../component/DirectionComponent"),a=e("../sharedComponent/InputData"),s=e("../component/MotionControllerComponent"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.OnUpdate=function(){if(null!=this.entities)for(var e=a.default.instance,t=0;t<this.entities.length;t++)1==this.motions[t].canMove&&(this.motionController[t].type,this.directions[t].direction=cc.Vec2.ZERO,e.right&&(this.directions[t].direction.x+=1),e.left&&(this.directions[t].direction.x-=1),e.up&&(this.directions[t].direction.y+=1),e.down&&(this.directions[t].direction.y-=1),this.directions[t].direction.normalizeSelf(),this.motions[t].v=this.directions[t].direction.mul(this.motions[t].speed))},__decorate([ECS.inject(i.default)],t.prototype,"directions",void 0),__decorate([ECS.inject(o.default)],t.prototype,"motions",void 0),__decorate([ECS.inject(s.default)],t.prototype,"motionController",void 0),t}(ECS.ComponentSystem);n.default=c,cc._RF.pop()},{"../component/DirectionComponent":"DirectionComponent","../component/MotionComponent":"MotionComponent","../component/MotionControllerComponent":"MotionControllerComponent","../sharedComponent/InputData":"InputData"}],MovementTest:[function(e,t,n){"use strict";cc._RF.push(t,"27e3d7+AHdIboJqy5Na1SoR","MovementTest"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,i=o.ccclass,a=(o.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=1,t}var n;return __extends(t,e),n=t,t.prototype.start=function(){return __awaiter(this,void 0,void 0,function(){var e,t,o,i,a=this;return __generator(this,function(s){switch(s.label){case 0:return this.node.position=cc.Vec2.ZERO,e=!1,Logger.log("start","MovementTest"),this.pressing_w=!1,this.pressing_a=!1,this.pressing_s=!1,this.pressing_d=!1,(t=new SimCivil.Contract.CreateRoleOption).Gender=SimCivil.Contract.Gender.male,t.Name="jyk",t.Race=SimCivil.Contract.Race.human,[4,SimCivil.Contract.IRoleManager.CreateRole(t)];case 1:return 1==s.sent()?Logger.log("CreateRole success\uff01","MovementTest"):Logger.log("CreateRole faild","MovementTest"),i=(o=SimCivil.Contract.IRoleManager).UseRole,[4,SimCivil.Contract.IRoleManager.GetRoleList()];case 2:return[4,i.apply(o,[s.sent()[0].Id])];case 3:return 1!=s.sent()?[3,5]:(Logger.log("UseRole success\uff01","MovementTest"),[4,SimCivil.Contract.IViewSynchronizer.RegisterViewSync(function(t){t=t,0==e&&(a.node.position=a.serverPosToUIPos(new cc.Vec2(t.Position.Item1,t.Position.Item2)),e=!0,a.schedule(function(){return a.logicUpdate()},n.deltaTimePreFrame)),Logger.info(t)})]);case 4:return s.sent(),[3,6];case 5:Logger.log("UseRole faild","MovementTest"),s.label=6;case 6:return cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),[2]}})})},t.prototype.logicUpdate=function(){Logger.log(this.node.position,name);var e=this.uiPosToServerPos(this.node.position);SimCivil.Contract.IPlayerController.MoveTo(new SimCivil.Contract.ValueTuple({Item1:e.x,Item2:e.y}),new Date)},t.prototype.update=function(e){var t=new cc.Vec2(0,0);this.pressing_w&&t.addSelf(cc.Vec2.UP),this.pressing_a&&t.subSelf(cc.Vec2.RIGHT),this.pressing_s&&t.subSelf(cc.Vec2.UP),this.pressing_d&&t.addSelf(cc.Vec2.RIGHT),t.normalizeSelf(),this.node.position=this.node.position.add(this.serverPosToUIPos(t.mul(this.speed*e)))},t.prototype.uiPosToServerPos=function(e){return new cc.Vec2(e.x/100,e.y/100)},t.prototype.serverPosToUIPos=function(e){return e.mul(100)},t.prototype.onKeyDown=function(e){switch(e.keyCode){case cc.macro.KEY.w:this.pressing_w=!0;break;case cc.macro.KEY.a:this.pressing_a=!0;break;case cc.macro.KEY.s:this.pressing_s=!0;break;case cc.macro.KEY.d:this.pressing_d=!0}},t.prototype.onKeyUp=function(e){switch(e.keyCode){case cc.macro.KEY.w:this.pressing_w=!1;break;case cc.macro.KEY.a:this.pressing_a=!1;break;case cc.macro.KEY.s:this.pressing_s=!1;break;case cc.macro.KEY.d:this.pressing_d=!1}},t.deltaTimePreFrame=1,t=n=__decorate([i],t)}(cc.Component));n.default=a,cc._RF.pop()},{}],Npc:[function(e,t,n){"use strict";cc._RF.push(t,"877cfTRpQdD9LCJAMhiG5Tu","Npc"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,i=o.ccclass,a=(o.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),t=__decorate([i],t)}(cc.Component));n.default=a,cc._RF.pop()},{}],PlayerMotionSyncSystem:[function(e,t,n){"use strict";cc._RF.push(t,"20cfalIhZVA1Zlq+cA8Vt0z","PlayerMotionSyncSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../component/MotionComponent"),i=e("../component/MotionControllerComponent"),a=e("../component/PositionComponent"),s=e("../utility/EcsUtility"),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.OnStart=function(){s.EcsUtility.LastSyncMotionTime=new Date},t.prototype.OnUpdate=function(){var e=new Date;if(this.motion.length>0){var t=this.motion[0].v.mul((e-s.EcsUtility.LastSyncMotionTime)/1e3);this.pos[0].position=this.pos[0].position.add(t),SimCivil.Contract.IPlayerController.MoveTo(new SimCivil.Contract.ValueTupleFloat({Item1:this.pos[0].position.x,Item2:this.pos[0].position.y}),e)}s.EcsUtility.LastSyncMotionTime=e},__decorate([ECS.inject(a.default)],t.prototype,"pos",void 0),__decorate([ECS.inject(o.default)],t.prototype,"motion",void 0),__decorate([ECS.inject(i.default)],t.prototype,"controller",void 0),t}(ECS.ComponentSystem);n.default=c,cc._RF.pop()},{"../component/MotionComponent":"MotionComponent","../component/MotionControllerComponent":"MotionControllerComponent","../component/PositionComponent":"PositionComponent","../utility/EcsUtility":"EcsUtility"}],Player:[function(e,t,n){"use strict";cc._RF.push(t,"d44576A8VpP97b9YORzMgN7","Player"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../ecs/component/MotionComponent"),i=e("../../ecs/component/PositionComponent"),a=e("../../ecs/component/MotionControllerComponent"),s=e("../../ecs/component/DirectionComponent"),c=e("./Npc"),r=e("../../ecs/utility/EcsUtility"),l=cc._decorator,u=l.ccclass,p=(l.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){this._entity=ECS.World.active.EntitisManager.CreateAEntity(),ECS.World.active.EntitisManager.addComponent(this._entity,o.default,i.default,a.default,s.default),Logger.log("add player"),this.posComp=ECS.World.active.EntitisManager.GetComponent(this._entity,i.default)},t.prototype.update=function(){this.node.position=this.posComp.position.mul(r.EcsUtility.LogicToUIRatio)},t=__decorate([u],t)}(c.default));n.default=p,cc._RF.pop()},{"../../ecs/component/DirectionComponent":"DirectionComponent","../../ecs/component/MotionComponent":"MotionComponent","../../ecs/component/MotionControllerComponent":"MotionControllerComponent","../../ecs/component/PositionComponent":"PositionComponent","../../ecs/utility/EcsUtility":"EcsUtility","./Npc":"Npc"}],PopupWarningUI:[function(e,t,n){"use strict";cc._RF.push(t,"1d5923CL8ZOPIyPH1il1aeS","PopupWarningUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UIBase"),i=e("../tools/GloableUtils"),a=cc._decorator,s=a.ccclass,c=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.text=null,t}return __extends(t,e),t.prototype.hide=function(){UIAnimationUtils.ScaleOut(this.node)},t.prototype.show=function(){UIAnimationUtils.ScaleIn(this.node)},t.prototype.clickOk=function(){i.GloableUtils.TipsOnclickOk()},t.prototype.clickCancel=function(){i.GloableUtils.TipsOnclickCancel()},__decorate([c(cc.Label)],t.prototype,"text",void 0),t=__decorate([s],t)}(o.default);n.default=r,cc._RF.pop()},{"../tools/GloableUtils":"GloableUtils","./UIBase":"UIBase"}],PositionComponent:[function(e,t,n){"use strict";cc._RF.push(t,"b75ecH6AD5P27gQ7Re/Kq5B","PositionComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){this.position=cc.Vec2.ZERO}}();n.default=o,cc._RF.pop()},{}],ResourcesManager:[function(e,t,n){"use strict";cc._RF.push(t,"381adfWfv1FV7Exm6dQCyL7","ResourcesManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../tools/GloableConstantUtils"),i=function(){function e(){this.atlasMap=new Array}return e.prototype.Init=function(){},e.prototype.loadRes=function(e,t){cc.loader.loadRes(e,t)},e.prototype.loadAtlas=function(e,t){var n=this;this.atlasMap[e]?t(null,this.atlasMap[e]):cc.loader.loadRes(o.GloableConstantUtils.AtlasPath.concat(e),cc.SpriteAtlas,function(o,i){o||(n.atlasMap[e]=i,i.getTexture().setFilters(cc.Texture2D.Filter.NEAREST,cc.Texture2D.Filter.NEAREST)),t(o,i)})},e.Instance=new e,e}();n.ResourcesManager=i,cc._RF.pop()},{"../tools/GloableConstantUtils":"GloableConstantUtils"}],RoleSystem:[function(e,t,n){"use strict";cc._RF.push(t,"3a299Ze1GNNjpEZABNEgmyf","RoleSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../tools/GloableConstantUtils"),i=e("../../manager/ResourcesManager"),a=e("../utility/EcsUtility"),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.OnStart=function(){var e=this,t=new SimCivil.Contract.CreateRoleOption;t.Gender=SimCivil.Contract.Gender.male,t.Name="jyk",t.Race=SimCivil.Contract.Race.human,a.EcsUtility.GotRole=!1,__awaiter(e,void 0,void 0,function(){var e,n,s;return __generator(this,function(c){switch(c.label){case 0:return[4,SimCivil.Contract.IRoleManager.CreateRole(t)];case 1:return 1==c.sent()?Logger.log("CreateRole success\uff01","MovementTest"):Logger.log("CreateRole faild","MovementTest"),e=a.EcsUtility,s=(n=SimCivil.Contract.IRoleManager).UseRole,[4,SimCivil.Contract.IRoleManager.GetRoleList()];case 2:return[4,s.apply(n,[c.sent()[0].Id])];case 3:return e.GotRole=c.sent(),1==a.EcsUtility.GotRole?i.ResourcesManager.Instance.loadRes(o.GloableConstantUtils.GamePrefabPath.concat("Player"),function(e,t){e?Logger.log(e.message):cc.instantiate(t).setParent(cc.Canvas.instance.node)}):Logger.log("UseRole faild","MovementTest"),[2]}})})},t.prototype.OnDestroy=function(){a.EcsUtility.GotRole=!1},t.prototype.OnUpdate=function(){},t}(ECS.ComponentSystem);n.default=s,cc._RF.pop()},{"../../manager/ResourcesManager":"ResourcesManager","../../tools/GloableConstantUtils":"GloableConstantUtils","../utility/EcsUtility":"EcsUtility"}],SceneEnum:[function(e,t,n){"use strict";cc._RF.push(t,"1af1a1KMtlBQa2+1bCV/U41","SceneEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.MAIN="main",e.LAUNCHER="launcher"}(n.SceneEnum||(n.SceneEnum={})),cc._RF.pop()},{}],SizeComponent:[function(e,t,n){"use strict";cc._RF.push(t,"fa573VRhLNGvKipxojDfY9p","SizeComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],StateEnum:[function(e,t,n){"use strict";cc._RF.push(t,"29b9ctEixBAKr6iH86UBQPJ","StateEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.GAME_STATE_LOGIN=0]="GAME_STATE_LOGIN",e[e.GAME_STATE_SCENE_LOADING=1]="GAME_STATE_SCENE_LOADING",e[e.GAME_STATE_MAIN_NORMAL=2]="GAME_STATE_MAIN_NORMAL"}(n.GameStateEnum||(n.GameStateEnum={})),cc._RF.pop()},{}],TestComponent2:[function(e,t,n){"use strict";cc._RF.push(t,"590141a2TBEg70CSjc1E2yo","TestComponent2"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],TestComponent:[function(e,t,n){"use strict";cc._RF.push(t,"7399cBpIRFIm6N7HcUAe0YN","TestComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],TextLocalization:[function(e,t,n){"use strict";cc._RF.push(t,"80575NOVc1KPLH+qkR9bE9+","TextLocalization"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../enum/EventEnum"),i=e("../manager/LocalizationManager"),a=cc._decorator,s=a.ccclass,c=a.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="",t.text=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.text=this.node.getComponent(cc.Label),null==this.text&&(this.text=this.node.getComponent(cc.RichText)),null==this.text&&(this.text=this.node.getComponent(cc.EditBox)),this.refreshLocalization(),this.node.on(o.EventEnum.RefreshLocalizationText,this.refreshLocalization)},t.prototype.onDestroy=function(){this.node.off(o.EventEnum.RefreshLocalizationText,this.refreshLocalization)},t.prototype.refreshLocalization=function(){null!=this.text&&(this.text instanceof cc.EditBox?this.text.placeholder=i.LocalizationManager.Instance.GetLocalizationTextByKey(this.key):this.text.string=i.LocalizationManager.Instance.GetLocalizationTextByKey(this.key))},__decorate([c],t.prototype,"key",void 0),t=__decorate([s],t)}(cc.Component);n.default=r,cc._RF.pop()},{"../enum/EventEnum":"EventEnum","../manager/LocalizationManager":"LocalizationManager"}],UIAnimationUtils:[function(e,t,n){"use strict";cc._RF.push(t,"8611ciZCwBIxIdzCwicxPyd","UIAnimationUtils");(function(){function e(){}e.ScaleIn=function(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=1),e.active=!0,e.scale=n,e.stopAllActions();var i=cc.scaleTo(.5,o).easing(cc.easeBackOut());if(void 0!=t&&null!=t){var a=cc.sequence(i,cc.callFunc(t));e.runAction(a)}else e.runAction(i)},e.ScaleOut=function(e,t,n,o){void 0===n&&(n=1),void 0===o&&(o=0),e.scale=n,e.stopAllActions();var i=cc.scaleTo(.5,o).easing(cc.easeBackIn()),a=cc.sequence(i,cc.callFunc(function(){e.active=!1,void 0!=t&&null!=t&&t()}));e.runAction(a)},e.MoveIn=function(e,t,n,o){void 0===n&&(n=cc.Vec2.ZERO),void 0===o&&(o=null),e.active=!0,null!=o&&(e.position=o),e.stopAllActions();var i=cc.moveTo(1,n).easing(cc.easeBackOut());if(void 0!=t&&null!=t){var a=cc.sequence(i,cc.callFunc(t));e.runAction(a)}else e.runAction(i)},e.MoveOut=function(e,t,n,o){void 0===n&&(n=cc.Vec2.ZERO),void 0===o&&(o=null),null!=o&&(e.position=o),e.stopAllActions();var i=cc.moveTo(1,n).easing(cc.easeBackIn()),a=cc.sequence(i,cc.callFunc(function(){e.active=!1,void 0!=t&&null!=t&&t()}));e.runAction(a)}})();cc._RF.pop()},{}],UIBase:[function(e,t,n){"use strict";cc._RF.push(t,"49e920GPCZCLbsZZhLVQ7R6","UIBase"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,i=o.ccclass,a=o.property,s=o.disallowMultiple,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.zIndex=0,t}return __extends(t,e),t.prototype.init=function(){this.node.zIndex=this.zIndex},t.prototype.hide=function(){},t.prototype.show=function(){},__decorate([a()],t.prototype,"zIndex",void 0),t=__decorate([i,s],t)}(cc.Component);n.default=c,cc._RF.pop()},{}],UIManager:[function(e,t,n){"use strict";cc._RF.push(t,"6687doIZMNNgJj1UjL9Qlh0","UIManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../tools/GloableConstantUtils"),i=e("./ResourcesManager"),a=function(){function e(){}return Object.defineProperty(e.prototype,"Canvas",{get:function(){return this.canvas},enumerable:!0,configurable:!0}),e.prototype.Init=function(){this.canvas=cc.Canvas.instance,this.uiDictionary=new Array},e.prototype.ShowUI=function(e,t,n){var a=this;void 0===t&&(t=null),void 0===n&&(n=this.canvas.node),Logger.log("ShowUI "+e,"UIManager"),void 0==this.uiDictionary[e]?(this.uiDictionary[e]=null,i.ResourcesManager.Instance.loadRes(o.GloableConstantUtils.UIPrefabPath.concat(e),function(o,i){if(null==o){var s=cc.instantiate(i);a.uiDictionary[e]=s.getComponent(e),s.parent=n,null==a.uiDictionary[e]?(Logger.error('Get null component from the ui named "'+e+'"',"UIManager"),null!=t&&t(new Error('Get null component from the ui named "'+e+'"'),null)):(a.uiDictionary[e].init(),a.uiDictionary[e].show(),null!=t&&t(null,a.uiDictionary[e]))}else null!=t&&t(o,null)})):null==this.uiDictionary[e]?(Logger.error('There are many places attempt to show the same UI "'+e+'"',"UIManager"),null!=t&&t(new Error('There are many places attempt to show the same UI "'+e+'"'),null)):(this.uiDictionary[e].show(),null!=t&&t(null,this.uiDictionary[e]))},e.prototype.HideUI=function(e){Logger.log("HideUI "+e,"UIManager"),void 0!=this.uiDictionary[e]&&null!=this.uiDictionary[e]&&this.uiDictionary[e].hide()},e.prototype.GetUI=function(e){return this.uiDictionary[e]},e.prototype.DestroyUI=function(e){void 0!=this.uiDictionary[e]&&1==cc.isValid(this.uiDictionary[e])&&(this.uiDictionary[e].node.destroy(),this.uiDictionary[e]=void 0)},e.prototype.DestroyAll=function(){for(;this.uiDictionary.length>0;){var e=this.uiDictionary.pop();null!=e&&void 0!=e&&e.node.destroy()}cc.loader.releaseAll()},e.Instance=new e,e}();n.UIManager=a,cc._RF.pop()},{"../tools/GloableConstantUtils":"GloableConstantUtils","./ResourcesManager":"ResourcesManager"}],UINameEnum:[function(e,t,n){"use strict";cc._RF.push(t,"e14066hHE9EwJUA9LGMMG2V","UINameEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.LOGIN_UI="LoginUI",e.LOADING_UI="LoadingUI",e.POP_UP_WARNING_UI="PopupWarningUI",e.MAIN_UI="MainUI",e.MAIN_UI_EQUIP_COMPONENT="MainUIEquipComponent",e.EDITE_UI="EditUI",e.DEFAULT="null"}(n.UINameEnum||(n.UINameEnum={})),cc._RF.pop()},{}],ViewChangeData:[function(e,t,n){"use strict";cc._RF.push(t,"5e8f650DP9Amp5HyLr9+Aib","ViewChangeData"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],ViewSyncSystem:[function(e,t,n){"use strict";cc._RF.push(t,"c90276XGDNDMo2wUxG02arD","ViewSyncSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../utility/EcsUtility"),i=e("../sharedComponent/ViewChangeData"),a=e("../../tools/GloableUtils"),s=e("../component/PositionComponent"),c=e("../component/MotionControllerComponent"),r=e("../component/MotionComponent"),l=e("../sharedComponent/MapDataComponent"),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.OnStart=function(){var e=this;ECS.World.active.EntitisManager.addSharedComponent(i.default),i.default.instance.data=null,i.default.instance.gotData=!1,o.EcsUtility.InitedViewSyncSystem=!1,o.EcsUtility.RegisterViewSyncOpt=__awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return 0!=o.EcsUtility.GotRole?[3,2]:[4,a.GloableUtils.Delay(500)];case 1:return e.sent(),[3,0];case 2:return[4,SimCivil.Contract.IViewSynchronizer.RegisterViewSync(function(e){i.default.instance.data=e})];case 3:return e.sent(),o.EcsUtility.InitedViewSyncSystem=!0,[2]}})})},t.prototype.OnDestroy=function(){ECS.World.active.EntitisManager.removeSharedComponent(i.default),o.EcsUtility.InitedViewSyncSystem=!1},t.prototype.OnUpdate=function(){if(null!=i.default.instance.data&&null!=this.positions&&this.positions.length>0){var e=new cc.Vec2(i.default.instance.data.Position.Item1,i.default.instance.data.Position.Item2);if(this.positions[0].position.sub(e).magSqr()>1||0==i.default.instance.gotData){if(Logger.log("\u51fa\u73b0\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4f4d\u7f6e\u4e0d\u540c\u6b65\u7684\u95ee\u9898\uff01\u5ba2\u6237\u7aef\u4f4d\u7f6e:"+this.positions[0].position+" ; \u670d\u52a1\u5668\u4f4d\u7f6e:"+e,"ViewChange"),o.EcsUtility.LastSyncMotionTime=new Date,0==i.default.instance.gotData){i.default.instance.gotData=!0;var t=0;SimCivil.Contract.IViewSynchronizer.GetAtlas(new SimCivil.Contract.ValueTupleInt32({Item1:0,Item2:0})).then(function(e){e&&(l.default.instance.ceilsFromServer=l.default.instance.ceilsFromServer.concat(e),9==++t&&(l.default.instance.centerPositionDirty=!0))});for(var n=0;n<8;n++){a.GloableUtils.dx[n],a.GloableUtils.dy[n];SimCivil.Contract.IViewSynchronizer.GetAtlas(new SimCivil.Contract.ValueTupleInt32({Item1:0+a.GloableUtils.dx[n],Item2:0+a.GloableUtils.dy[n]})).then(function(e){e&&(l.default.instance.ceilsFromServer=l.default.instance.ceilsFromServer.concat(e),9==++t&&(l.default.instance.centerPositionDirty=!0))})}}this.positions[0].position=e,this.motions[0].speed=i.default.instance.data.Speed}}},__decorate([ECS.inject(r.default)],t.prototype,"motions",void 0),__decorate([ECS.inject(s.default)],t.prototype,"positions",void 0),__decorate([ECS.inject(c.default)],t.prototype,"motionController",void 0),t}(ECS.ComponentSystem);n.default=u,cc._RF.pop()},{"../../tools/GloableUtils":"GloableUtils","../component/MotionComponent":"MotionComponent","../component/MotionControllerComponent":"MotionControllerComponent","../component/PositionComponent":"PositionComponent","../sharedComponent/MapDataComponent":"MapDataComponent","../sharedComponent/ViewChangeData":"ViewChangeData","../utility/EcsUtility":"EcsUtility"}]},{},["DirectionComponent","GraphicComponent","MapCeilComponent","MotionComponent","MotionControllerComponent","PositionComponent","SizeComponent","TestComponent","TestComponent2","InputData","MapDataComponent","ViewChangeData","CameraSystem","InputSystem","MapSystem","MotionControllerSystem","PlayerMotionSyncSystem","RoleSystem","ViewSyncSystem","EcsUtility","ComponentUINameEnum","EventEnum","JsonConfigNameEnum","LocalStorageEnum","MapCeilTypEnum","SceneEnum","StateEnum","UINameEnum","GameStateLogin","GameStateMainNormal","GameStateSceneLoading","GameLauncher","MapCeilUIComponent","Npc","Player","EditableComponentUIManager","GameManager","LocalizationManager","ResourcesManager","UIManager","MapCeil","MovementTest","GloableConstantUtils","GloableUtils","JsonConfigUtils","TextLocalization","UIAnimationUtils","PopupWarningUI","UIBase","EditableComponentContainer","EditableComponentContainerConfigure","EditableComponentUI","EditableComponentUIConfigure","LoadingUI","LoginUI","MainUI","MainUIEquipComponent"]);