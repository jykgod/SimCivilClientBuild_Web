window.__require=function e(t,n,o){function a(s,c){if(!n[s]){if(!t[s]){var r=s.split("/");if(r=r[r.length-1],!t[r]){var l="function"==typeof __require&&__require;if(!c&&l)return l(r,!0);if(i)return i(r,!0);throw new Error("Cannot find module '"+s+"'")}}var u=n[s]={exports:{}};t[s][0].call(u.exports,function(e){return a(t[s][1][e]||e)},u,u.exports,e,t,n,o)}return n[s].exports}for(var i="function"==typeof __require&&__require,s=0;s<o.length;s++)a(o[s]);return a}({AbilityIndex:[function(e,t,n){"use strict";cc._RF.push(t,"407b5lC3tFFJrPzGXDBAWic","AbilityIndex"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.ReconstructionAbility=0]="ReconstructionAbility",e[e.ResolvingAbility=1]="ResolvingAbility",e[e.PerceptionAbility=2]="PerceptionAbility",e[e.ControllingAbility=3]="ControllingAbility",e[e.MentalAbility=4]="MentalAbility",e[e.Vision=5]="Vision",e[e.Creativity=6]="Creativity",e[e.Memory=7]="Memory",e[e.Understanding=8]="Understanding",e[e.Consciousness=9]="Consciousness",e[e.Digestion=10]="Digestion",e[e.Reaction=11]="Reaction",e[e.Endurance=12]="Endurance",e[e.Antitoxic=13]="Antitoxic",e[e.UpperPower=14]="UpperPower",e[e.LowerPower=15]="LowerPower",e[e.UpperDexterity=16]="UpperDexterity",e[e.LowerDexterity=17]="LowerDexterity",e[e.AbilityCount=18]="AbilityCount"}(n.AbilityIndex||(n.AbilityIndex={})),cc._RF.pop()},{}],AttriDispComponentUI:[function(e,t,n){"use strict";cc._RF.push(t,"d37f3zWDo1KRLpjinMeSu4h","AttriDispComponentUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../manager/LocalizationManager"),a=cc._decorator,i=a.ccclass,s=a.property,c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.SetValue=function(e,t){this.NameLabel.string=o.LocalizationManager.Instance.GetLocalizationTextByKey(e)+":",this.NameLabel._updateRenderData(!0),this.ValueLabel.string=t,this.ValueLabel.node.position=cc.v2(this.NameLabel.node.getContentSize().width+5,0)},__decorate([s(cc.Label)],t.prototype,"NameLabel",void 0),__decorate([s(cc.Label)],t.prototype,"ValueLabel",void 0),t=__decorate([i],t)}(cc.Component);n.default=c,cc._RF.pop()},{"../../manager/LocalizationManager":"LocalizationManager"}],Avatar:[function(e,t,n){"use strict";cc._RF.push(t,"3892f35bNpCLI4/q0GO7iCV","Avatar"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../tools/GloableConstantUtils"),a=e("../../manager/ResourcesManager"),i=function(){function e(e){this.node=e,this.loaded=!1}return e.prototype.load=function(){return __awaiter(this,void 0,Promise,function(){var e=this;return __generator(this,function(t){return[2,new Promise(function(t,n){a.ResourcesManager.Instance.loadRes(o.GloableConstantUtils.GamePrefabPath+"Avatar",function(o,a){if(o)return Logger.error(o,"Avatar"),void n();cc.instantiate(a).setParent(e.node),e.loaded=!0,t()})})]})})},e}();n.default=i,cc._RF.pop()},{"../../manager/ResourcesManager":"ResourcesManager","../../tools/GloableConstantUtils":"GloableConstantUtils"}],BodyPartIndex:[function(e,t,n){"use strict";cc._RF.push(t,"57914t0COdEu48WUzHPha/W","BodyPartIndex"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.Soul=0]="Soul",e[e.LeftEye=1]="LeftEye",e[e.RightEye=2]="RightEye",e[e.Brain=3]="Brain",e[e.LeftEar=4]="LeftEar",e[e.RightEar=5]="RightEar",e[e.Mouth=6]="Mouth",e[e.Digestive=7]="Digestive",e[e.Lung=8]="Lung",e[e.Heart=9]="Heart",e[e.Immunity=10]="Immunity",e[e.LeftArm=11]="LeftArm",e[e.RightArm=12]="RightArm",e[e.LeftHand=13]="LeftHand",e[e.RightHand=14]="RightHand",e[e.LeftLeg=15]="LeftLeg",e[e.RightLeg=16]="RightLeg",e[e.LeftFoot=17]="LeftFoot",e[e.RightFoot=18]="RightFoot",e[e.BodyPartCount=19]="BodyPartCount"}(n.BodyPartIndex||(n.BodyPartIndex={})),cc._RF.pop()},{}],CameraSystem:[function(e,t,n){"use strict";cc._RF.push(t,"8bdf2/vQ7dP+YutUYBHE+l8","CameraSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../manager/ResourcesManager"),a=e("../../tools/GloableConstantUtils"),i=e("../sharedComponent/MapDataComponent"),s=e("../component/MotionControllerComponent"),c=e("../component/PositionComponent"),r=e("../utility/EcsUtility"),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.OnUpdate=function(){if(!(this.positions.length<=0||void 0==i.default.instance.cameraNode)){for(var e=cc.Vec2.ZERO,t=0;t<this.positions.length;t++)e.addSelf(this.positions[t].position);e.divSelf(this.positions.length);var n=e.clone();n.subSelf(i.default.instance.centerPosition);var o=n.mag();o*r.EcsUtility.LogicToUIRatio>100&&(n.mulSelf(100/(o*r.EcsUtility.LogicToUIRatio)),(n=e.sub(n))!=i.default.instance.centerPosition&&(i.default.instance.centerPositionDirty=!0,i.default.instance.centerPosition=n,i.default.instance.cameraNode.position=i.default.instance.centerPosition.mul(r.EcsUtility.LogicToUIRatio)))}},t}return __extends(t,e),t.prototype.OnStart=function(){o.ResourcesManager.Instance.loadRes(a.GloableConstantUtils.GamePrefabPath.concat("GameCamera"),function(e,t){if(e)Logger.log(e.message);else{var n=cc.instantiate(t);n.setParent(cc.Canvas.instance.node),i.default.instance.cameraNode=n}})},t.prototype.OnDestroy=function(){i.default.instance.cameraNode.destroy(),i.default.instance.cameraNode=null},__decorate([ECS.inject(s.default)],t.prototype,"motionControllers",void 0),__decorate([ECS.inject(c.default)],t.prototype,"positions",void 0),t}(ECS.ComponentSystem);n.default=l,cc._RF.pop()},{"../../manager/ResourcesManager":"ResourcesManager","../../tools/GloableConstantUtils":"GloableConstantUtils","../component/MotionControllerComponent":"MotionControllerComponent","../component/PositionComponent":"PositionComponent","../sharedComponent/MapDataComponent":"MapDataComponent","../utility/EcsUtility":"EcsUtility"}],ChooseRoleUIComponent:[function(e,t,n){"use strict";cc._RF.push(t,"7e6df9M7mJOu6LD70xJFIiT","ChooseRoleUIComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../logic/player/Avatar"),a=e("../../enum/EventEnum"),i=e("../../ecs/sharedComponent/PlayerAssetsData"),s=e("../../logic/GameLauncher"),c=cc._decorator,r=c.ccclass,l=c.property,u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.role=null,t.roleData=null,t}return __extends(t,e),t.prototype.onLoad=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return s.default.Instance.node.on(a.EventEnum.ChooseRole,this.onChangeRoleEvent,this),this.role=new o.default(this.roleNode),[4,this.role.load()];case 1:return e.sent(),this.refresh(),[2]}})})},t.prototype.SetData=function(e){this.roleData=e,this.nameLabel.string=""+e.Name,this.raceLabel.string=""+e.Race,this.refresh()},t.prototype.OnClick=function(){null!=this.roleData&&void 0!=this.roleData&&(i.default.instance.Role=this.roleData,s.default.Instance.node.emit(a.EventEnum.ChooseRole,this.roleData))},t.prototype.onChangeRoleEvent=function(e){this.roleData==e?this.choosed.active=!0:this.choosed.active=!1},t.prototype.onDestroy=function(){s.default.Instance.node.off(a.EventEnum.ChooseRole,this.OnClick,this)},t.prototype.refresh=function(){null!=this.roleData&&null!=this.role&&this.role.loaded},__decorate([l(cc.Node)],t.prototype,"roleNode",void 0),__decorate([l(cc.Label)],t.prototype,"nameLabel",void 0),__decorate([l(cc.Label)],t.prototype,"raceLabel",void 0),__decorate([l(cc.Node)],t.prototype,"choosed",void 0),t=__decorate([r],t)}(cc.Component);n.ChooseRoleUIComponent=u,cc._RF.pop()},{"../../ecs/sharedComponent/PlayerAssetsData":"PlayerAssetsData","../../enum/EventEnum":"EventEnum","../../logic/GameLauncher":"GameLauncher","../../logic/player/Avatar":"Avatar"}],ChooseRoleUI:[function(e,t,n){"use strict";cc._RF.push(t,"1b150eHX/VP95oQKKpF5C+B","ChooseRoleUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../UIBase"),a=e("../../manager/ResourcesManager"),i=e("../../tools/GloableConstantUtils"),s=e("./ChooseRoleUIComponent"),c=e("../../manager/UIManager"),r=e("../../enum/UINameEnum"),l=e("../../manager/GameManager"),u=e("../../enum/StateEnum"),p=e("../../enum/SceneEnum"),d=e("../../enum/EventEnum"),m=e("../../ecs/sharedComponent/PlayerAssetsData"),f=e("../../logic/GameLauncher"),h=cc._decorator,g=h.ccclass,y=h.property,C=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.components=new Array,t}return __extends(t,e),t.prototype.show=function(){UIAnimationUtils.ScaleIn(this.node)},t.prototype.Refresh=function(e){var t=this;this.clear(),null!=e&&void 0!=e&&a.ResourcesManager.Instance.loadRes(i.GloableConstantUtils.UIPrefabPath+"ChooseRoleUIComponent",function(n,o){if(n)Logger.error(n,"ChooseRoleUI");else{for(var a=0;a<e.length;a++){var i=cc.instantiate(o);t.components.push(i.getComponent(s.ChooseRoleUIComponent)),t.components[a].node.setParent(t.RolesComponentsNode),t.components[a].SetData(e[a])}m.default.instance.Role=e[0],f.default.Instance.node.emit(d.EventEnum.ChooseRole,e[0])}})},t.prototype.clear=function(){for(var e=0;e<this.components.length;e++)this.components[e].destroy();this.components=new Array},t.prototype.CreateRole=function(){c.UIManager.Instance.ShowUI(r.UINameEnum.POP_UP_CREATE_ROLE_UI)},t.prototype.ChooseRole=function(){__awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,SimCivil.Contract.IRoleManager.UseRole(m.default.instance.Role.Id)];case 1:return 1==e.sent()&&(c.UIManager.Instance.HideUI(r.UINameEnum.CHOOSE_ROLE_UI),l.GameManager.Instance.stateMachine.ChangeState(u.GameStateEnum.GAME_STATE_SCENE_LOADING,p.SceneEnum.MAIN,u.GameStateEnum.GAME_STATE_MAIN_NORMAL)),[2]}})})},t.prototype.hide=function(){UIAnimationUtils.ScaleOut(this.node)},__decorate([y(cc.Node)],t.prototype,"RolesComponentsNode",void 0),t=__decorate([g],t)}(o.default);n.ChooseRoleUI=C,cc._RF.pop()},{"../../ecs/sharedComponent/PlayerAssetsData":"PlayerAssetsData","../../enum/EventEnum":"EventEnum","../../enum/SceneEnum":"SceneEnum","../../enum/StateEnum":"StateEnum","../../enum/UINameEnum":"UINameEnum","../../logic/GameLauncher":"GameLauncher","../../manager/GameManager":"GameManager","../../manager/ResourcesManager":"ResourcesManager","../../manager/UIManager":"UIManager","../../tools/GloableConstantUtils":"GloableConstantUtils","../UIBase":"UIBase","./ChooseRoleUIComponent":"ChooseRoleUIComponent"}],ComponentUINameEnum:[function(e,t,n){"use strict";cc._RF.push(t,"332f06PDuVG26fK59TkzYJh","ComponentUINameEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.DEFAULT="null"}(n.ComponentUINameEnum||(n.ComponentUINameEnum={})),cc._RF.pop()},{}],DirectionComponent:[function(e,t,n){"use strict";cc._RF.push(t,"f778co7FtJBeqazeMWh3kpa","DirectionComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){this.direction=cc.Vec2.ZERO}}();n.default=o,cc._RF.pop()},{}],EcsUtility:[function(e,t,n){"use strict";cc._RF.push(t,"636d21fNKdHlq7iso7mbvFV","EcsUtility"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../enum/NpcTypeEnum"),a=e("../../struct/NpcAssets"),i=e("../component/NpcComponent"),s=e("../sharedComponent/NpcAssetsData"),c=e("../component/PositionComponent"),r=e("../component/GraphicComponent"),l=e("../component/HealthComponent"),u=e("../component/MotionComponent"),p=e("../component/MotionControllerComponent"),d=e("../component/DirectionComponent"),m=e("../sharedComponent/PlayerAssetsData"),f=function(){function e(){}return e.AddNpcAsset=function(e,t,n,c,r){void 0===n&&(n=o.NpcTypeEnum.npc);var l=new a.default(e,t,n);return l.roleSummary=c,l.inspect=r,ECS.World.active.EntitisManager.addComponent(e,i.default),ECS.World.active.EntitisManager.GetComponent(e,i.default).npcAssets=l,s.default.instance.npcAssetsDict[t]=l,l},e.AddNpc=function(t){var n=ECS.World.active.EntitisManager.CreateAEntity(),a=new SimCivil.Contract.RoleSummary;a.Id=t.Id,a.Name=t.Name;var s=e.AddNpcAsset(n,t.Id,o.NpcTypeEnum.olPlayer,a);return ECS.World.active.EntitisManager.addComponent(n,i.default,c.default,r.default,d.default,l.default),ECS.World.active.EntitisManager.GetComponent(n,i.default).npcAssets=s,ECS.World.active.EntitisManager.GetComponent(n,l.default).HP=t.Hp,ECS.World.active.EntitisManager.GetComponent(n,c.default).position=cc.v2(t.Pos[0],t.Pos[1]),n},e.AddPlayer=function(){var t=ECS.World.active.EntitisManager.CreateAEntity(),n=e.AddNpcAsset(t,m.default.instance.Role.Id,o.NpcTypeEnum.player,m.default.instance.Role);return ECS.World.active.EntitisManager.addComponent(t,u.default,p.default,d.default,i.default,c.default,r.default,l.default),ECS.World.active.EntitisManager.GetComponent(t,i.default).npcAssets=n,m.default.instance.npcAssets=n,ECS.World.active.EntitisManager.GetComponent(t,l.default).HP=10,t},e.LogicToUIRatio=80,e.SyncPositionDeltaTime=100,e}();n.EcsUtility=f,cc._RF.pop()},{"../../enum/NpcTypeEnum":"NpcTypeEnum","../../struct/NpcAssets":"NpcAssets","../component/DirectionComponent":"DirectionComponent","../component/GraphicComponent":"GraphicComponent","../component/HealthComponent":"HealthComponent","../component/MotionComponent":"MotionComponent","../component/MotionControllerComponent":"MotionControllerComponent","../component/NpcComponent":"NpcComponent","../component/PositionComponent":"PositionComponent","../sharedComponent/NpcAssetsData":"NpcAssetsData","../sharedComponent/PlayerAssetsData":"PlayerAssetsData"}],EditableComponentContainerConfigure:[function(e,t,n){"use strict";cc._RF.push(t,"b6c12wK4RdBho+MBlw+ti3X","EditableComponentContainerConfigure"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t}(LocalStorageBase);n.EditableComponentContainerConfigure=o,cc._RF.pop()},{}],EditableComponentContainer:[function(e,t,n){"use strict";cc._RF.push(t,"6351fzF651AKa2GbH5Wc4/J","EditableComponentContainer"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./EditableComponentContainerConfigure"),a=e("../../enum/ComponentUINameEnum"),i=e("../UIBase"),s=e("../../enum/LocalStorageEnum"),c=e("../../manager/EditableComponentUIManager"),r=cc._decorator,l=r.ccclass,u=r.property,p=r.requireComponent,d=r.disallowMultiple,m=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.editableComponentUIArr=[],t.subUIArr=[],t}return __extends(t,e),t.prototype.start=function(){var e=this;Logger.log("start","EditableComponentUIContainer"),this.release(),this.subUIArr=[];this.node.getComponent(i.default);if(this.conf=LocalStorageUtils.loadStorageObject(s.LocalStorageEnum.EDITABLE_CONTAINER_PREFIX.concat(this.node.name)),null==this.conf){this.conf=new o.EditableComponentContainerConfigure(s.LocalStorageEnum.EDITABLE_CONTAINER_PREFIX.concat(this.node.name)),this.conf.keys=[],Logger.log(this.node.name+" \u672c\u5730\u914d\u7f6e\u8bfb\u53d6\u5931\u8d25\uff0c\u7528prefab\u4e0a\u7684\u914d\u7f6e\u521b\u5efa\u5b50UI","EditableComponentUIContainer");for(var t=0;t<this.editableComponentUIArr.length;t++)c.EditableComponentUIManager.Instance.CreateEditableComponentUI(this.node.name,this.editableComponentUIArr[t].fatherNode,this.editableComponentUIArr[t].name,function(t){e.subUIArr.push(t),e.conf.keys.push(t.Key),e.conf.keys.length==e.editableComponentUIArr.length&&e.conf.Save()})}else{Logger.log(this.node.name+" \u4f7f\u7528\u672c\u5730\u914d\u7f6e\u521b\u5efa\u5b50UI","EditableComponentUIContainer"),Logger.info(this.conf);for(t=0;t<this.conf.keys.length;t++)c.EditableComponentUIManager.Instance.LoadEditableComponentUI(this.conf.keys[t],function(t){e.subUIArr.push(t)})}},t.prototype.addSubUI=function(e){null!=this.conf&&void 0!=this.conf&&(this.subUIArr.push(e),this.conf.keys.push(e.Key),this.conf.Save())},t.prototype.release=function(){if(null!=this.subUIArr)for(var e=0;e<this.subUIArr.length;e++)this.subUIArr[e].node.destroy()},t.prototype.onDestroy=function(){this.release()},__decorate([u([cc.Class({name:"ComponentUIStruct",properties:{name:{default:a.ComponentUINameEnum.DEFAULT,tooltip:"\u53ef\u7f16\u8f91\u7ec4\u4ef6UI\u7684\u540d\u5b57\uff08\u4eceComponentUINameEnum\u91cc\u9762\u53d6\uff09"},fatherNode:{type:cc.Node,default:null,tooltip:"\u53ef\u7f16\u8f91\u7ec4\u4ef6UI\u9700\u8981\u6302\u8f7d\u7684\u8282\u70b9"}}})])],t.prototype,"editableComponentUIArr",void 0),t=__decorate([l,d,p(i.default)],t)}(cc.Component);n.EditableComponentUIContainer=m,cc._RF.pop()},{"../../enum/ComponentUINameEnum":"ComponentUINameEnum","../../enum/LocalStorageEnum":"LocalStorageEnum","../../manager/EditableComponentUIManager":"EditableComponentUIManager","../UIBase":"UIBase","./EditableComponentContainerConfigure":"EditableComponentContainerConfigure"}],EditableComponentUIConfigure:[function(e,t,n){"use strict";cc._RF.push(t,"589daM8EFRMf7RBbyU0L0ec","EditableComponentUIConfigure"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.clone=function(e){var n=new t(e);return n.uiname=this.uiname,n.pos=this.pos,n.scale=this.scale,n.fatherUI=this.fatherUI,n.parentNodePath=this.parentNodePath,n.data=this.data,n},t}(LocalStorageBase);n.EditableComponentUIConfigure=o,cc._RF.pop()},{}],EditableComponentUIManager:[function(e,t,n){"use strict";cc._RF.push(t,"60b19feBENPIpkRA31jhPVx","EditableComponentUIManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../ui/editableui/EditableComponentUI"),a=e("../ui/editableui/EditableComponentUIConfigure"),i=e("../tools/GloableConstantUtils"),s=e("../enum/LocalStorageEnum"),c=e("./UIManager"),r=e("../tools/GloableUtils"),l=function(){function e(){}return e.prototype.LoadEditableComponentUI=function(e,t){var n=LocalStorageUtils.loadStorageObject(e);Logger.info(n),cc.loader.loadRes(i.GloableConstantUtils.UIPrefabPath.concat(n.uiname.toString()),function(a,i){if(null!=a)return Logger.error("load res error key:"+e,"EditableComponent"),void(null!=t&&t(null));var s=cc.instantiate(i).getComponent(o.EditableComponentUI);s.Conf=n,1==s.resetUIStateByConfig()?(s.show(n.data),t(s)):(s.node.destroy(),null!=t&&t(null))})},e.prototype.CreateEditableComponentUI=function(e,t,n,l){var u=c.UIManager.Instance.GetUI(e);if(null==u||void 0==u)return Logger.log("\u7236UI\u4e3a\u7a7a","CreateEditableComponentUI "+e+" "+t+" "+n),void(null!=l&&l(null));var p=r.GloableUtils.GetNodePath(u.node,t);if(null==p)return Logger.log("\u627e\u4e0d\u5230\u7236\u8282\u70b9","CreateEditableComponentUI"),void(null!=l&&l(null));cc.loader.loadRes(i.GloableConstantUtils.UIPrefabPath.concat(n.toString()),function(i,c){if(null!=i)return Logger.error("load res error key:"+n,"EditableComponent"),void(null!=l&&l(null));var r=cc.instantiate(c),u=r.getComponent(o.EditableComponentUI);r.parent=t;var d=LocalStorageUtils.getNumber(s.LocalStorageEnum.EDITABLE_UI_COUNT)+1;LocalStorageUtils.setNumber(s.LocalStorageEnum.EDITABLE_UI_COUNT,d);var m=new a.EditableComponentUIConfigure(s.LocalStorageEnum.EDITABLE_UI_PREFIX.concat(d.toString()));m.fatherUI=e,m.parentNodePath=p,m.pos=r.position,m.scale=r.scale,m.uiname=n,m.Save(),u.Conf=m,u.show(null),null!=l&&l(u)})},e.Instance=new e,e}();n.EditableComponentUIManager=l,cc._RF.pop()},{"../enum/LocalStorageEnum":"LocalStorageEnum","../tools/GloableConstantUtils":"GloableConstantUtils","../tools/GloableUtils":"GloableUtils","../ui/editableui/EditableComponentUI":"EditableComponentUI","../ui/editableui/EditableComponentUIConfigure":"EditableComponentUIConfigure","./UIManager":"UIManager"}],EditableComponentUI:[function(e,t,n){"use strict";cc._RF.push(t,"c1d72LimzlFrqEaNAIwlTzE","EditableComponentUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../tools/GloableUtils"),a=e("../../enum/UINameEnum"),i=e("./EditableComponentUIConfigure"),s=e("../../enum/LocalStorageEnum"),c=e("../../manager/UIManager"),r=e("../../manager/EditableComponentUIManager"),l=e("../../tools/GloableConstantUtils"),u=e("./EditableComponentContainer"),p=cc._decorator,d=p.ccclass,m=(p.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pressEnterEditModeDeltaTime=1,t}return __extends(t,e),Object.defineProperty(t.prototype,"Key",{get:function(){return null==this.conf?null:this.conf.Key()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Editing",{get:function(){return this.editing},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){var e=this;Logger.log("onload","EditableComponentUI"),this.clickTimes=0,this.onPressing=!1,this.editing=!1,this.lastOnPressTimes=0;var t=this.node.getBoundingBoxToWorld();this.node.width=t.width,this.node.height=t.height,this.node.on(cc.Node.EventType.TOUCH_START,function(t){e.onPressEditCallBack(t)}),this.node.on(cc.Node.EventType.TOUCH_END,function(t){e.onReleaseEditCallBack(t)}),this.node.on(cc.Node.EventType.TOUCH_MOVE,function(t){e.onMoveEditCallBack(t)})},t.prototype.onPressEditCallBack=function(e){0==this.editing?this.onPressNotEditing(e):this.onPressEditing(e),this.lastOnPressTimes=TimeManager.Instance.realTimeSinceStartScene,this.onPressing=!0},t.prototype.onMoveEditCallBack=function(e){0==this.editing?this.onMoveNotEditing(e):this.onMoveEditing(e)},t.prototype.onReleaseEditCallBack=function(e){0==this.editing?this.onReleaseNotEditing(e):this.onReleaseEditing(e),this.onPressing=!1},t.prototype.onPressEditing=function(e){Logger.log("onPressEditing","EditableComponentUI")},t.prototype.onReleaseEditing=function(e){Logger.log("onReleaseEditing","EditableComponentUI")},t.prototype.onMoveEditing=function(e){1==this.onPressing&&(Logger.log("onMoveEditing","EditableComponentUI"),this.node.position=this.node.position.add(e.getDelta()))},t.prototype.onPressNotEditing=function(e){Logger.log("onPressNotEditing","EditableComponentUI")},t.prototype.onReleaseNotEditing=function(e){Logger.log("onReleaseNotEditing","EditableComponentUI")},t.prototype.onMoveNotEditing=function(e){Logger.log("onMoveNotEditing","EditableComponentUI")},t.prototype.update=function(){var e=this;0==this.editing&&1==this.onPressing&&TimeManager.Instance.realTimeSinceStartScene-this.lastOnPressTimes>this.pressEnterEditModeDeltaTime&&(this.onPressing=!1,null==this.editUI||void 0==this.editUI?cc.loader.loadRes(l.GloableConstantUtils.UIPrefabPath.concat(a.UINameEnum.EDITE_UI),function(t,n){if(null==t){e.editing=!0,e.editUI=cc.instantiate(n),e.editUI.width=e.node.width,e.editUI.height=e.node.height,e.editUI.parent=e.node;var o=e.editUI.getChildByName("Layout"),a=new cc.Component.EventHandler;a.target=e.node,a.component="EditableComponentUI",a.handler="save",o.getChildByName("ok").getComponent(cc.Button).clickEvents.push(a),(a=new cc.Component.EventHandler).target=e.node,a.component="EditableComponentUI",a.handler="cancel",o.getChildByName("cancel").getComponent(cc.Button).clickEvents.push(a),(a=new cc.Component.EventHandler).target=e.node,a.component="EditableComponentUI",a.handler="copy",o.getChildByName("add").getComponent(cc.Button).clickEvents.push(a)}else e.editing=!1}):(this.editing=!0,this.editUI.active=!0))},t.prototype.cancel=function(){this.resetUIStateByConfig(),this.editing=!1,null!=this.editUI&&void 0!=this.editUI&&(this.editUI.active=!1)},t.prototype.copy=function(){var e=this;this.clone(function(t){if(e.editing=!1,null!=e.editUI&&void 0!=e.editUI&&null!=e.fatherUI&&void 0!=e.fatherUI){var n=e.fatherUI.node.getComponent(u.EditableComponentUIContainer);e.editUI.active=!1,n.addSubUI(t)}})},t.prototype.save=function(){if(null!=this.editUI&&void 0!=this.editUI&&(this.editUI.active=!1),this.editing=!1,null!=this.fatherUI&&void 0!=this.fatherUI){c.UIManager.Instance.GetUI(this.conf.fatherUI);this.conf.parentNodePath=o.GloableUtils.GetNodePath(this.fatherUI.node,this.node.parent),this.conf.scale=this.node.scale,this.conf.pos=this.node.position,Logger.info(this.conf),this.conf.Save()}},t.prototype.clone=function(e){var t=LocalStorageUtils.getNumber(s.LocalStorageEnum.EDITABLE_UI_COUNT)+1;LocalStorageUtils.setNumber(s.LocalStorageEnum.EDITABLE_UI_COUNT,t);var n=this.conf.clone(s.LocalStorageEnum.EDITABLE_UI_PREFIX.concat(t.toString()));Logger.info(n),n.pos=n.pos.add(cc.Vec2.RIGHT.mul(this.node.width)),n.Save(),r.EditableComponentUIManager.Instance.LoadEditableComponentUI(n.Key(),e)},t.prototype.resetUIStateByConfig=function(){return this.fatherUI=c.UIManager.Instance.GetUI(this.conf.fatherUI),null!=this.fatherUI&&void 0!=this.fatherUI&&(this.node.parent=cc.find(this.conf.parentNodePath,this.fatherUI.node),this.node.scale=this.conf.scale,this.node.position=this.conf.pos,Logger.info(this.node),!0)},Object.defineProperty(t.prototype,"Conf",{set:function(e){this.conf=e,null!=e&&void 0!=e&&(this.conf.pos=cc.v2(this.conf.pos.x,this.conf.pos.y),this.conf.clone=i.EditableComponentUIConfigure.prototype.clone)},enumerable:!0,configurable:!0}),t.prototype.show=function(e){},t.prototype.delate=function(){},t.prototype.hide=function(){},t=__decorate([d],t)}(cc.Component));n.EditableComponentUI=m,cc._RF.pop()},{"../../enum/LocalStorageEnum":"LocalStorageEnum","../../enum/UINameEnum":"UINameEnum","../../manager/EditableComponentUIManager":"EditableComponentUIManager","../../manager/UIManager":"UIManager","../../tools/GloableConstantUtils":"GloableConstantUtils","../../tools/GloableUtils":"GloableUtils","./EditableComponentContainer":"EditableComponentContainer","./EditableComponentUIConfigure":"EditableComponentUIConfigure"}],EffectIndex:[function(e,t,n){"use strict";cc._RF.push(t,"4e602tHfyRCb6CAiOOxSHBp","EffectIndex"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.MaterialMagicPower=0]="MaterialMagicPower",e[e.DeformationMagicPower=1]="DeformationMagicPower",e[e.BuffMagicPower=2]="BuffMagicPower",e[e.DecompositionMagicPower=3]="DecompositionMagicPower",e[e.MagicLearningEfficiency=4]="MagicLearningEfficiency",e[e.SpiritResistance=5]="SpiritResistance",e[e.SummonMagicPower=6]="SummonMagicPower",e[e.SpaceTimeMagicPower=7]="SpaceTimeMagicPower",e[e.PerceptionMagicPower=8]="PerceptionMagicPower",e[e.MagicTransformEfficiency=9]="MagicTransformEfficiency",e[e.ControllingMagicPower=10]="ControllingMagicPower",e[e.MagicHitRate=11]="MagicHitRate",e[e.MagicLearningRate=12]="MagicLearningRate",e[e.AimingAccuracy=13]="AimingAccuracy",e[e.SightRange=14]="SightRange",e[e.InventionProbability=15]="InventionProbability",e[e.AimingSpeed=16]="AimingSpeed",e[e.SkillLearningRate=17]="SkillLearningRate",e[e.DigestionEfficiency=18]="DigestionEfficiency",e[e.MaximumEndurance=19]="MaximumEndurance",e[e.TemperatureRange=20]="TemperatureRange",e[e.MaximumLoad=21]="MaximumLoad",e[e.UpperAttackEfficiency=22]="UpperAttackEfficiency",e[e.UpperAttackHitRate=23]="UpperAttackHitRate",e[e.UpperAttackSpeed=24]="UpperAttackSpeed",e[e.OperationEfficiency=25]="OperationEfficiency",e[e.CraftEfficiency=26]="CraftEfficiency",e[e.DodgeRate=27]="DodgeRate",e[e.MaximumJumpHeight=28]="MaximumJumpHeight",e[e.LowerAttackEfficiency=29]="LowerAttackEfficiency",e[e.LowerAttackHitRate=30]="LowerAttackHitRate",e[e.LowerAttackSpeed=31]="LowerAttackSpeed",e[e.MoveSpeed=32]="MoveSpeed",e[e.EffectCount=33]="EffectCount"}(n.EffectIndex||(n.EffectIndex={})),cc._RF.pop()},{}],EventEnum:[function(e,t,n){"use strict";cc._RF.push(t,"f9d47tY1oBC/py/nFzmYrXY","EventEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.GameSceneLoadingProgress="0",e.RefreshLocalizationText="1",e.ChooseRole="2"}(n.EventEnum||(n.EventEnum={})),cc._RF.pop()},{}],FuncKeySystem:[function(e,t,n){"use strict";cc._RF.push(t,"32ccd9QYqhC5KHqIXqTUuxQ","FuncKeySystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../sharedComponent/InputData"),a=e("../../manager/UIManager"),i=e("../../enum/UINameEnum"),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.OnUpdate=function(){if(1==o.default.instance.e){o.default.instance.e=!1;var e=a.UIManager.Instance.GetUI(i.UINameEnum.USER_INFO_UI);if(void 0!=e&&null!=e&&1==e.node.active)return void a.UIManager.Instance.HideUI(i.UINameEnum.USER_INFO_UI);a.UIManager.Instance.ShowUI(i.UINameEnum.USER_INFO_UI)}},t}return __extends(t,e),t}(ECS.ComponentSystem);n.default=s,cc._RF.pop()},{"../../enum/UINameEnum":"UINameEnum","../../manager/UIManager":"UIManager","../sharedComponent/InputData":"InputData"}],GameLauncher:[function(e,t,n){"use strict";cc._RF.push(t,"0b8dfG8JZ1CZKnBYQPSA01v","GameLauncher"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../manager/GameManager"),a=e("../manager/UIManager"),i=e("../manager/LocalizationManager"),s=e("../manager/ResourcesManager"),c=e("../manager/UI2EcsSessionManager"),r=e("../ecs/system/InputSystem"),l=e("../ecs/sharedComponent/UISessionDate"),u=e("../ecs/behaviour/NpcBehaviour"),p=cc._decorator,d=p.ccclass,m=(p.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}var n;return __extends(t,e),n=t,Object.defineProperty(t,"Instance",{get:function(){return this.instance},enumerable:!0,configurable:!0}),t.prototype.onLoad=function(){n.instance=this,cc.game.addPersistRootNode(this.node),s.ResourcesManager.Instance.Init(),TimeManager.Instance.Init(),i.LocalizationManager.Instance.Init("cn"),a.UIManager.Instance.Init(),o.GameManager.Instance.Init(),c.UI2EcsSessionManager.Instance.Init();var e=ECS.World.CreateAWorld("simsivil");e.addSystem(r.default),e.defineBehaviour(u.default),ECS.World.active.EntitisManager.addSharedComponent(l.default)},t.prototype.update=function(e){TimeManager.Instance.Update(e),o.GameManager.Instance.Update(e),c.UI2EcsSessionManager.Instance.Update(e),null!=ECS.World.active&&void 0!=ECS.World.active&&ECS.World.active.update()},t.prototype.onDestroy=function(){ECS.World.RemoveWorld("simsivil")},t.prototype.setScreenFit=function(){},t.instance=null,t=n=__decorate([d],t)}(cc.Component));n.default=m,cc._RF.pop()},{"../ecs/behaviour/NpcBehaviour":"NpcBehaviour","../ecs/sharedComponent/UISessionDate":"UISessionDate","../ecs/system/InputSystem":"InputSystem","../manager/GameManager":"GameManager","../manager/LocalizationManager":"LocalizationManager","../manager/ResourcesManager":"ResourcesManager","../manager/UI2EcsSessionManager":"UI2EcsSessionManager","../manager/UIManager":"UIManager"}],GameManager:[function(e,t,n){"use strict";cc._RF.push(t,"06411YLVhtDQ5LQkf2swjkJ","GameManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../fsm/gameState/GameStateLogin"),a=e("../fsm/gameState/GameStateSceneLoading"),i=e("../enum/StateEnum"),s=e("../fsm/gameState/GameStateMainNormal"),c=function(){function e(){}return e.prototype.Init=function(){this.stateMachine=FSM.StateMachine.GetBuilder().AddState(new o.GameStateLogin).AddState(new a.GameStateSceneLoading).AddState(new s.GameStateMainNormal).build(),this.stateMachine.ChangeState(i.GameStateEnum.GAME_STATE_LOGIN)},e.prototype.Update=function(e){this.stateMachine.Update()},e.Instance=new e,e}();n.GameManager=c,cc._RF.pop()},{"../enum/StateEnum":"StateEnum","../fsm/gameState/GameStateLogin":"GameStateLogin","../fsm/gameState/GameStateMainNormal":"GameStateMainNormal","../fsm/gameState/GameStateSceneLoading":"GameStateSceneLoading"}],GameStateLogin:[function(e,t,n){"use strict";cc._RF.push(t,"9248bedY4hBY5qH+oMjI0Jz","GameStateLogin"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../enum/StateEnum"),a=e("../../manager/UIManager"),i=e("../../enum/UINameEnum"),s=function(){function e(){this.stateType=o.GameStateEnum.GAME_STATE_LOGIN}return e.prototype.StateEnter=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];Logger.log("state login","GameStateLogin"),a.UIManager.Instance.ShowUI(i.UINameEnum.LOGIN_UI)},e.prototype.StateEnd=function(e){a.UIManager.Instance.HideUI(i.UINameEnum.LOGIN_UI)},e}();n.GameStateLogin=s,cc._RF.pop()},{"../../enum/StateEnum":"StateEnum","../../enum/UINameEnum":"UINameEnum","../../manager/UIManager":"UIManager"}],GameStateMainNormal:[function(e,t,n){"use strict";cc._RF.push(t,"db97e4xE5VO07XQxyKMmVyi","GameStateMainNormal"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../enum/StateEnum"),a=e("../../manager/UIManager"),i=e("../../enum/UINameEnum"),s=e("../../ecs/system/MapSystem"),c=e("../../ecs/system/ViewSyncSystem"),r=e("../../ecs/system/MotionControllerSystem"),l=e("../../ecs/system/PlayerMotionSyncSystem"),u=e("../../ecs/system/CameraSystem"),p=e("../../ecs/system/FuncKeySystem"),d=e("../../ecs/utility/EcsUtility"),m=e("../../ecs/system/PositionSTGSystem"),f=function(){function e(){this.stateType=o.GameStateEnum.GAME_STATE_MAIN_NORMAL}return e.prototype.StateEnter=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];a.UIManager.Instance.ShowUI(i.UINameEnum.MAIN_UI),ECS.World.active.addSystem(s.default),ECS.World.active.addSystem(u.default),ECS.World.active.addSystem(c.default),ECS.World.active.addSystem(r.default),ECS.World.active.addSystem(l.default),ECS.World.active.addSystem(p.default),ECS.World.active.addSystem(m.default),d.EcsUtility.AddPlayer()},e.prototype.StateUpdate=function(e){},e.prototype.StateEnd=function(e){ECS.World.active.removeSystem(l.default),ECS.World.active.removeSystem(r.default),ECS.World.active.removeSystem(c.default),ECS.World.active.removeSystem(u.default),ECS.World.active.removeSystem(s.default),a.UIManager.Instance.HideUI(i.UINameEnum.MAIN_UI)},e}();n.GameStateMainNormal=f,cc._RF.pop()},{"../../ecs/system/CameraSystem":"CameraSystem","../../ecs/system/FuncKeySystem":"FuncKeySystem","../../ecs/system/MapSystem":"MapSystem","../../ecs/system/MotionControllerSystem":"MotionControllerSystem","../../ecs/system/PlayerMotionSyncSystem":"PlayerMotionSyncSystem","../../ecs/system/PositionSTGSystem":"PositionSTGSystem","../../ecs/system/ViewSyncSystem":"ViewSyncSystem","../../ecs/utility/EcsUtility":"EcsUtility","../../enum/StateEnum":"StateEnum","../../enum/UINameEnum":"UINameEnum","../../manager/UIManager":"UIManager"}],GameStateSceneLoading:[function(e,t,n){"use strict";cc._RF.push(t,"5bbf6SuyHVKSL+l93+spA1c","GameStateSceneLoading"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../enum/StateEnum"),a=e("../../manager/UIManager"),i=e("../../enum/UINameEnum"),s=e("../../logic/GameLauncher"),c=e("../../enum/EventEnum"),r=e("../../manager/GameManager"),l=function(){function e(){this.stateType=o.GameStateEnum.GAME_STATE_SCENE_LOADING}return e.prototype.StateEnter=function(e,t){for(var n=[],o=2;o<arguments.length;o++)n[o-2]=arguments[o];a.UIManager.Instance.ShowUI(i.UINameEnum.LOADING_UI),cc.director.loadScene(e,function(){var e;(e=r.GameManager.Instance.stateMachine).ChangeState.apply(e,[t].concat(n))})},e.prototype.StateUpdate=function(e){s.default.Instance.node.emit(c.EventEnum.GameSceneLoadingProgress,e)},e.prototype.StateEnd=function(e){a.UIManager.Instance.HideUI(i.UINameEnum.LOADING_UI)},e}();n.GameStateSceneLoading=l,cc._RF.pop()},{"../../enum/EventEnum":"EventEnum","../../enum/StateEnum":"StateEnum","../../enum/UINameEnum":"UINameEnum","../../logic/GameLauncher":"GameLauncher","../../manager/GameManager":"GameManager","../../manager/UIManager":"UIManager"}],GloableConstantUtils:[function(e,t,n){"use strict";cc._RF.push(t,"fdba0DRkoBLcKywyb9dWZSz","GloableConstantUtils"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){}return e.UIPrefabPath="prefab/ui/",e.TestPrefabPath="prefab/test/",e.GamePrefabPath="prefab/game/",e.AtlasPath="image/atlas/",e.JsonPath="json/",e.mapZIndex=-1e3,e}();n.GloableConstantUtils=o,cc._RF.pop()},{}],GloableUtils:[function(e,t,n){"use strict";cc._RF.push(t,"0008ew41hJGPJOX3QUVe7Mw","GloableUtils"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../manager/UIManager"),a=e("../enum/UINameEnum"),i=e("./JsonConfigUtils"),s=function(){return function(e,t,n){this.content=e,this.okCallBack=t,this.cancelCallBack=n}}(),c=function(){function e(){}return e.ShowTips=function(t,n,o){void 0===n&&(n=null),void 0===o&&(o=null),null==e.tipsPendingQueue&&(e.tipsPendingQueue=new Tools.Queue),e.tipsPendingQueue.Enqueue(new s(t,n,o)),1==e.tipsPendingQueue.count&&e.RealShowTips()},e.RealShowTips=function(){var t=e.tipsPendingQueue.first;o.UIManager.Instance.ShowUI(a.UINameEnum.POP_UP_WARNING_UI,function(n,o){null==n?(Logger.log("show tips,content:"+t.content,"TIP"),o.text.string=t.content):e.tipsPendingQueue.Dequeue()})},e.TipsOnclickOk=function(){var t=e.tipsPendingQueue.Dequeue();null!=t.okCallBack&&t.okCallBack(),Logger.log("click ok,content:"+t.content,"TIP"),0==e.tipsPendingQueue.count?o.UIManager.Instance.HideUI(a.UINameEnum.POP_UP_WARNING_UI):e.RealShowTips()},e.TipsOnclickCancel=function(){var t=e.tipsPendingQueue.Dequeue();null!=t.cancelCallBack&&t.cancelCallBack(),Logger.log("click cancel,content:"+t.content,"TIP"),0==e.tipsPendingQueue.count?o.UIManager.Instance.HideUI(a.UINameEnum.POP_UP_WARNING_UI):e.RealShowTips()},e.GetNodePath=function(e,t){for(var n=null;null!=t&&void 0!=t&&e!=t;)n=null!=n?t.name.concat("/".concat(n)):t.name,t=t.parent;return n},e.Delay=function(e){return new Promise(function(t,n){setTimeout(function(){return t()},e)})},e.prototype.GetAtalasAndCeilName=function(e,t,n,o){i.JsonConigUtils.ReadJsonObjectByName("MapAtlasNameConfig",function(a,i){if(a)Logger.error(a,"GetAtalasAndCeilName");else if(i=i[e.toString()]){if(e==t)i=i[0],t=i[0].other_type;else{for(var s=!1,c=0;c<i.length;c++)if(i[c].other_type==t){i=i[c],s=!0;break}if(0==s)return void Logger.error("\u627e\u4e0d\u5230\u5730\u5f62"+e+"\u5728\u5468\u56f4\u5730\u5f62\u4e3a"+t+"\u7684\u60c5\u51b5\u4e0b\u6240\u5bf9\u5e94\u7684\u56fe\u96c6\u914d\u7f6e","GetAtalasAndCeilName")}var r={};r.atlas=i.atals,r.id=e>t?(255&n).toString():n.toString(),o&&o(r)}else Logger.error("\u627e\u4e0d\u5230\u5730\u5f62"+e+"\u5bf9\u5e94\u7684\u56fe\u96c6\u914d\u7f6e","GetAtalasAndCeilName")})},e.GetMaskString=function(e){for(var t="",n=7;n>=0;n--)t+=(e&1<<n)>0?"1":"0";return t},e.tipsPendingQueue=null,e.dx=[-1,0,1,-1,1,-1,0,1],e.dy=[1,1,1,0,0,-1,-1,-1],e}();n.GloableUtils=c,cc._RF.pop()},{"../enum/UINameEnum":"UINameEnum","../manager/UIManager":"UIManager","./JsonConfigUtils":"JsonConfigUtils"}],GraphicComponent:[function(e,t,n){"use strict";cc._RF.push(t,"98665umGAxLYLGtM9VSFcOT","GraphicComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],HealthComponent:[function(e,t,n){"use strict";cc._RF.push(t,"f5ac9D3YUNGeKg5CNAM6S7W","HealthComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){this._hp=-1,this._dirty=!1}return Object.defineProperty(e.prototype,"HP",{get:function(){return this._hp},set:function(e){this._hp!=e&&(this._hp=e,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty",{get:function(){return this._dirty},set:function(e){this._dirty=e},enumerable:!0,configurable:!0}),e}();n.default=o,cc._RF.pop()},{}],InputData:[function(e,t,n){"use strict";cc._RF.push(t,"e2003rIYB9FkI6d5OKdWKjm","InputData"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],InputSystem:[function(e,t,n){"use strict";cc._RF.push(t,"5c52fc6VXJIoKuiK/MtVC8y","InputSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../sharedComponent/InputData"),a=e("../../logic/GameLauncher"),i=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.OnStart=function(){ECS.World.active.EntitisManager.addSharedComponent(o.default),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),a.default.Instance.node.on(cc.Node.EventType.MOUSE_DOWN,this.onMouseDown,this),a.default.Instance.node.on(cc.Node.EventType.MOUSE_UP,this.onMouseUp,this),a.default.Instance.node.on(cc.Node.EventType.MOUSE_MOVE,this.onMouseMove,this)},t.prototype.OnDestroy=function(){ECS.World.active.EntitisManager.removeSharedComponent(o.default),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.off(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),a.default.Instance.node.off(cc.Node.EventType.MOUSE_DOWN,this.onMouseDown,this),a.default.Instance.node.off(cc.Node.EventType.MOUSE_UP,this.onMouseUp,this),a.default.Instance.node.off(cc.Node.EventType.MOUSE_MOVE,this.onMouseMove,this)},t.prototype.onMouseDown=function(e){switch(e.getButton()){case cc.Event.EventMouse.BUTTON_LEFT:o.default.instance.mouse_left=!0;break;case cc.Event.EventMouse.BUTTON_RIGHT:o.default.instance.mouse_right=!0}o.default.instance.mousePosition=e.getLocation(),o.default.instance.time=TimeManager.Instance.realTimeSinceStartScene},t.prototype.onMouseUp=function(e){switch(e.getButton()){case cc.Event.EventMouse.BUTTON_LEFT:o.default.instance.mouse_left=!1;break;case cc.Event.EventMouse.BUTTON_RIGHT:o.default.instance.mouse_right=!1}o.default.instance.mousePosition=e.getLocation(),o.default.instance.time=TimeManager.Instance.realTimeSinceStartScene},t.prototype.onMouseMove=function(e){o.default.instance.mousePosition=e.getLocation(),o.default.instance.time=TimeManager.Instance.realTimeSinceStartScene},t.prototype.onKeyDown=function(e){switch(e.keyCode){case cc.macro.KEY.w:o.default.instance.up=!0;break;case cc.macro.KEY.a:o.default.instance.left=!0;break;case cc.macro.KEY.s:o.default.instance.down=!0;break;case cc.macro.KEY.d:o.default.instance.right=!0;break;case cc.macro.KEY.e:o.default.instance.e=!0}o.default.instance.time=TimeManager.Instance.realTimeSinceStartScene},t.prototype.onKeyUp=function(e){switch(e.keyCode){case cc.macro.KEY.w:o.default.instance.up=!1;break;case cc.macro.KEY.a:o.default.instance.left=!1;break;case cc.macro.KEY.s:o.default.instance.down=!1;break;case cc.macro.KEY.d:o.default.instance.right=!1;break;case cc.macro.KEY.e:o.default.instance.e=!1}o.default.instance.time=TimeManager.Instance.realTimeSinceStartScene},t}(ECS.ComponentSystem);n.default=i,cc._RF.pop()},{"../../logic/GameLauncher":"GameLauncher","../sharedComponent/InputData":"InputData"}],JsonConfigNameEnum:[function(e,t,n){"use strict";cc._RF.push(t,"836b4zYSEVOUaT+cLzaxwya","JsonConfigNameEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.Language_CN="cn",e.Language_EN="en",e.Client_Config="ClientConfig",e.Map_Atlas_Name="MapAtlasNameConfig"}(n.JsonConfigNameEnum||(n.JsonConfigNameEnum={})),cc._RF.pop()},{}],JsonConfigUtils:[function(e,t,n){"use strict";cc._RF.push(t,"d169eVRYu1CeJ93bkuNsFEU","JsonConfigUtils"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./GloableConstantUtils"),a=function(){function e(){}return e.ReadJsonObjectByPath=function(t,n){void 0==e.jsonObjectDict[t]||null==e.jsonObjectDict[t]?cc.loader.loadRes(t,cc.TextAsset,function(o,a){e.jsonObjectDict[t]=a.json,n(o,a.json)}):n(null,e.jsonObjectDict[t])},e.ReadJsonObjectByName=function(t,n){void 0==e.jsonObjectDict[t]||null==e.jsonObjectDict[t]?cc.loader.loadRes(o.GloableConstantUtils.JsonPath.concat(t),function(o,a){e.jsonObjectDict[t]=a.json,n(o,a.json)}):n(null,e.jsonObjectDict[t])},e.jsonObjectDict=new Array,e}();n.JsonConigUtils=a,cc._RF.pop()},{"./GloableConstantUtils":"GloableConstantUtils"}],LoadingUI:[function(e,t,n){"use strict";cc._RF.push(t,"dfed1kFWuBIwoqRmUrmL7ji","LoadingUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../UIBase"),a=cc._decorator,i=a.ccclass,s=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.hide=function(){this.node.active=!1},t.prototype.show=function(){this.node.active=!0},t=__decorate([i],t)}(o.default));n.default=s,cc._RF.pop()},{"../UIBase":"UIBase"}],LocalStorageEnum:[function(e,t,n){"use strict";cc._RF.push(t,"b535bm3Iv9HQISVC6+5qfzw","LocalStorageEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.ACCOUNT_ID="0_",e.ACCOUNT_PASS_WORD="1_",e.EDITABLE_UI_COUNT="2_",e.EDITABLE_UI_PREFIX="3_",e.EDITABLE_CONTAINER_PREFIX="4_",e.ENABLE_LOG="5_"}(n.LocalStorageEnum||(n.LocalStorageEnum={})),cc._RF.pop()},{}],LocalizationManager:[function(e,t,n){"use strict";cc._RF.push(t,"d8adaY0EuFMuoQSGnlZT75n","LocalizationManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../logic/GameLauncher"),a=e("../enum/EventEnum"),i=e("../enum/JsonConfigNameEnum"),s=e("../tools/JsonConfigUtils"),c=function(){function e(){this.inited=!1}return e.prototype.Init=function(e){var t=this;e==i.JsonConfigNameEnum.Language_CN?this.languageCode=i.JsonConfigNameEnum.Language_CN:this.languageCode=i.JsonConfigNameEnum.Language_EN,this.inited=!1,s.JsonConigUtils.ReadJsonObjectByName(this.languageCode,function(e,n){null==e&&(t.localizationDictionary=n,t.inited=!0,o.default.Instance.node.emit(a.EventEnum.RefreshLocalizationText))})},e.prototype.GetLocalizationTextByKey=function(e){return 0==this.inited?"...":this.localizationDictionary[e]},e.prototype.GetLocalizationTextByKeyWithParams=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];if(0==this.inited)return"...";var o=this.localizationDictionary[e];if(void 0!=t)for(var a=0;a<t.length;a++)o=o.replace("{"+a+"}",t[a]);return o},e.Instance=new e,e}();n.LocalizationManager=c,cc._RF.pop()},{"../enum/EventEnum":"EventEnum","../enum/JsonConfigNameEnum":"JsonConfigNameEnum","../logic/GameLauncher":"GameLauncher","../tools/JsonConfigUtils":"JsonConfigUtils"}],LoginUI:[function(e,t,n){"use strict";cc._RF.push(t,"85fd6rKxWlKYahdSTo36AYb","LoginUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../UIBase"),a=e("../../manager/GameManager"),i=e("../../enum/StateEnum"),s=e("../../enum/SceneEnum"),c=e("../../manager/LocalizationManager"),r=e("../../enum/JsonConfigNameEnum"),l=e("../../tools/GloableUtils"),u=e("../../tools/JsonConfigUtils"),p=e("../../manager/UIManager"),d=e("../../enum/UINameEnum"),m=e("../../ecs/system/RolesSystem"),f=cc._decorator,h=f.ccclass,g=f.property,y=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.accountEditBox=null,t.passwrodEditBox=null,t.loginButton=null,t.registerButton=null,t.ipEditBox=null,t}return __extends(t,e),t.prototype.hide=function(){UIAnimationUtils.ScaleOut(this.node)},t.prototype.show=function(){var e=this;u.JsonConigUtils.ReadJsonObjectByName(r.JsonConfigNameEnum.Client_Config,function(t,n){UIAnimationUtils.ScaleIn(e.node),0==n.Test?e.ipEditBox.enabled=!1:e.ipEditBox.string=n.ServerIP})},t.prototype.onClickLogin=function(){var e=this;this.SetButtonEnable(!1),this.CheckIfConnectServer(function(){return e.onClickLogin()})&&SimCivil.Contract.IAuth.LogInAsync(this.accountEditBox.string,this.passwrodEditBox.string).then(function(t){e.SetButtonEnable(!0),null==t||0==t?l.GloableUtils.ShowTips(c.LocalizationManager.Instance.GetLocalizationTextByKey("login_text_tips_error")):(ECS.World.active.addSystem(m.default),p.UIManager.Instance.ShowUI(d.UINameEnum.CHOOSE_ROLE_UI),p.UIManager.Instance.HideUI(d.UINameEnum.LOGIN_UI))})},t.prototype.onClickRegister=function(){var e=this;this.SetButtonEnable(!1),this.CheckIfConnectServer(function(){return e.onClickRegister()})&&SimCivil.Contract.IAuth.Register(this.accountEditBox.string,this.passwrodEditBox.string).then(function(t){e.SetButtonEnable(!0),null==t||0==t?l.GloableUtils.ShowTips(c.LocalizationManager.Instance.GetLocalizationTextByKey("register_text_tips_error")):l.GloableUtils.ShowTips(c.LocalizationManager.Instance.GetLocalizationTextByKey("register_text_tips_success"))})},t.prototype.SetButtonEnable=function(e){this.loginButton.interactable=e,this.registerButton.interactable=e},t.prototype.CheckIfConnectServer=function(e){var t=this;return null!=RpcClient.Instance.session&&0!=RpcClient.Instance.session.connected||(u.JsonConigUtils.ReadJsonObjectByName(r.JsonConfigNameEnum.Client_Config,function(n,o){null==n?1==o.OfflineMode?a.GameManager.Instance.stateMachine.ChangeState(i.GameStateEnum.GAME_STATE_SCENE_LOADING,s.SceneEnum.MAIN,i.GameStateEnum.GAME_STATE_MAIN_NORMAL):0==o.Test?RpcClient.Instance.Init(o.ServerIP,e):RpcClient.Instance.Init(t.ipEditBox.string,e):(t.SetButtonEnable(!0),l.GloableUtils.ShowTips(c.LocalizationManager.Instance.GetLocalizationTextByKey("connet_server_error")))}),!1)},__decorate([g(cc.EditBox)],t.prototype,"accountEditBox",void 0),__decorate([g(cc.EditBox)],t.prototype,"passwrodEditBox",void 0),__decorate([g(cc.Button)],t.prototype,"loginButton",void 0),__decorate([g(cc.Button)],t.prototype,"registerButton",void 0),__decorate([g(cc.EditBox)],t.prototype,"ipEditBox",void 0),t=__decorate([h],t)}(o.default);n.default=y,cc._RF.pop()},{"../../ecs/system/RolesSystem":"RolesSystem","../../enum/JsonConfigNameEnum":"JsonConfigNameEnum","../../enum/SceneEnum":"SceneEnum","../../enum/StateEnum":"StateEnum","../../enum/UINameEnum":"UINameEnum","../../manager/GameManager":"GameManager","../../manager/LocalizationManager":"LocalizationManager","../../manager/UIManager":"UIManager","../../tools/GloableUtils":"GloableUtils","../../tools/JsonConfigUtils":"JsonConfigUtils","../UIBase":"UIBase"}],MainUIEquipComponent:[function(e,t,n){"use strict";cc._RF.push(t,"2bd90K8z/9P4rudxEL0I5HW","MainUIEquipComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../editableui/EditableComponentUI"),a=cc._decorator,i=a.ccclass,s=(a.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.priRefresh=function(e){this.itemID=e},t.prototype.pubRefresh=function(e){this.itemID=e,this.conf.data={itemID:e},this.conf.Save()},t.prototype.show=function(e){var t=this;Logger.log("show","MainUIEquipComponent"),this.sprEquip=this.node.getChildByName("equip").getComponent(cc.Sprite),this.txtName=this.node.getChildByName("name").getComponent(cc.Label),null!=e&&(this.priRefresh(e.itemID),this.node.on(cc.Node.EventType.MOUSE_DOWN,function(){return t.onPressCallBack}))},t.prototype.onPressCallBack=function(){Logger.log("onPressCallBack","MainUIEquipComponent")},t=__decorate([i],t)}(o.EditableComponentUI));n.default=s,cc._RF.pop()},{"../editableui/EditableComponentUI":"EditableComponentUI"}],MainUI:[function(e,t,n){"use strict";cc._RF.push(t,"3adc0+9+IJOjbQA4CRFJiAk","MainUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../UIBase"),a=e("../../manager/UIManager"),i=cc._decorator,s=i.ccclass,c=i.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.topNode=null,t.bottomNode=null,t.topLeftNode=null,t.topRightNode=null,t.bottomLeftNode=null,t.bottomRightNode=null,t.centerNode=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.topNode.position=cc.Vec2.UP.mulSelf(a.UIManager.Instance.Canvas.node.height),this.bottomNode.position=cc.Vec2.UP.mulSelf(-a.UIManager.Instance.Canvas.node.height),this.topLeftNode.position=cc.Vec2.RIGHT.mulSelf(-a.UIManager.Instance.Canvas.node.width),this.topRightNode.position=cc.Vec2.RIGHT.mulSelf(a.UIManager.Instance.Canvas.node.width),this.bottomLeftNode.position=cc.Vec2.RIGHT.mulSelf(-a.UIManager.Instance.Canvas.node.width),this.bottomRightNode.position=cc.Vec2.RIGHT.mulSelf(a.UIManager.Instance.Canvas.node.width)},t.prototype.hide=function(){UIAnimationUtils.MoveOut(this.topNode,null,cc.Vec2.UP.mulSelf(a.UIManager.Instance.Canvas.node.height)),UIAnimationUtils.MoveOut(this.bottomNode,null,cc.Vec2.UP.mulSelf(-a.UIManager.Instance.Canvas.node.height)),UIAnimationUtils.MoveOut(this.topLeftNode,null,cc.Vec2.RIGHT.mulSelf(-a.UIManager.Instance.Canvas.node.width)),UIAnimationUtils.MoveOut(this.topRightNode,null,cc.Vec2.RIGHT.mulSelf(a.UIManager.Instance.Canvas.node.width)),UIAnimationUtils.MoveOut(this.bottomLeftNode,null,cc.Vec2.RIGHT.mulSelf(-a.UIManager.Instance.Canvas.node.width)),UIAnimationUtils.MoveOut(this.bottomRightNode,null,cc.Vec2.RIGHT.mulSelf(a.UIManager.Instance.Canvas.node.width)),UIAnimationUtils.ScaleOut(this.centerNode,null)},t.prototype.show=function(){UIAnimationUtils.MoveIn(this.topNode,null),UIAnimationUtils.MoveIn(this.bottomNode,null),UIAnimationUtils.MoveIn(this.topLeftNode,null),UIAnimationUtils.MoveIn(this.topRightNode,null),UIAnimationUtils.MoveIn(this.bottomLeftNode,null),UIAnimationUtils.MoveIn(this.bottomRightNode,null),UIAnimationUtils.ScaleIn(this.centerNode,null)},__decorate([c(cc.Node)],t.prototype,"topNode",void 0),__decorate([c(cc.Node)],t.prototype,"bottomNode",void 0),__decorate([c(cc.Node)],t.prototype,"topLeftNode",void 0),__decorate([c(cc.Node)],t.prototype,"topRightNode",void 0),__decorate([c(cc.Node)],t.prototype,"bottomLeftNode",void 0),__decorate([c(cc.Node)],t.prototype,"bottomRightNode",void 0),__decorate([c(cc.Node)],t.prototype,"centerNode",void 0),t=__decorate([s],t)}(o.default);n.default=r,cc._RF.pop()},{"../../manager/UIManager":"UIManager","../UIBase":"UIBase"}],MapCeilComponent:[function(e,t,n){"use strict";cc._RF.push(t,"1c23eHONW5FebVkWf+cH7oC","MapCeilComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],MapCeilTypEnum:[function(e,t,n){"use strict";cc._RF.push(t,"42ba58ILZVDnqCD/cZ8toK4","MapCeilTypEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.grass=0]="grass",e[e.path=1]="path",e[e.water=2]="water",e[e.end=3]="end"}(n.MapCeilTypeEnum||(n.MapCeilTypeEnum={})),cc._RF.pop()},{}],MapCeilUIComponent:[function(e,t,n){"use strict";cc._RF.push(t,"8c219KeSlBCSKdc1YGPJc40","MapCeilUIComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../../tools/GloableUtils"),a=e("../../manager/ResourcesManager"),i=e("../../ecs/utility/EcsUtility"),s=cc._decorator,c=s.ccclass,r=s.property,l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.sprites=[],t}return __extends(t,e),t.prototype.onLoad=function(){this.node.active=!1},t.prototype.update=function(e){var t=this;if(this.mapCeil.uiDirty){var n=this.mapCeil.ceil.Atlas;this.node.position=this.mapCeil.pos.mul(i.EcsUtility.LogicToUIRatio),null!=n&&(this.mapCeil.uiDirty=!1,a.ResourcesManager.Instance.loadAtlas(n,function(e,n){if(null==e)for(var a=t.mapCeil.ceil.Mask,i=0;i<a.length;i++)t.sprites[i].spriteFrame=n.getSpriteFrame(o.GloableUtils.GetMaskString(a[i]));else Logger.error(e,"MapCeilUIComponent")}))}},__decorate([r([cc.Sprite])],t.prototype,"sprites",void 0),t=__decorate([c],t)}(cc.Component);n.default=l,cc._RF.pop()},{"../../ecs/utility/EcsUtility":"EcsUtility","../../manager/ResourcesManager":"ResourcesManager","../../tools/GloableUtils":"GloableUtils"}],MapCeil:[function(e,t,n){"use strict";cc._RF.push(t,"470adiMN3VFt7gPVm2ObY65","MapCeil"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../tools/JsonConfigUtils"),a=e("../enum/JsonConfigNameEnum"),i=function(){function e(){this._type=-1,this._atlas=null}return Object.defineProperty(e.prototype,"type",{get:function(){return this._type},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Atlas",{get:function(){return this._atlas},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"Mask",{get:function(){return this._mask},enumerable:!0,configurable:!0}),e.prototype.Reset=function(e,t){var n=this;this._mask=[0,0,0,0];for(var i=0,s=e,c=0;c<t.length;c++)t[c]==e?i=1+(i<<1):(i<<=1,s=t[c]);if(this._type==e&&this.mask==i)return!1;if(this._type=e,this.mask=i,this._mask[0]=11+(128&i)+(64&i)+((64&i)>>1)+(16&i)+((16&i)>>2),this._mask[1]=22+((64&i)<<1)+(64&i)+(32&i)+(8&i)+((8&i)>>3),this._mask[2]=104+((16&i)<<3)+(16&i)+(4&i)+(2&i)+((2&i)>>1),this._mask[3]=208+((8&i)<<2)+(8&i)+((2&i)<<1)+(2&i)+(1&i),s<e)for(c=0;c<4;c++)this._mask[c]=255^this._mask[c];return o.JsonConigUtils.ReadJsonObjectByName(a.JsonConfigNameEnum.Map_Atlas_Name,function(t,o){for(var a=o[e.toString()],i=0;i<a.length;i++)if(a[i].other_type==s)return void(n._atlas=a[i].atlas);n._atlas=a[0].atlas}),!0},e}();n.default=i,cc._RF.pop()},{"../enum/JsonConfigNameEnum":"JsonConfigNameEnum","../tools/JsonConfigUtils":"JsonConfigUtils"}],MapDataComponent:[function(e,t,n){"use strict";cc._RF.push(t,"702a1HvRDFM6YZF1shcV/Jd","MapDataComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){this.centerPosition=cc.Vec2.ZERO,this.centerPositionDirty=!1,this.viewWidth=0,this.viewHeight=0,this.cacheWidth=50,this.cacheHeight=50,this.ceilsData=new Array,this.ceilsFromServer=new Array,this.mapCeilsInView=new Array,this.ceilsPosistionInied=!1}}();n.default=o,cc._RF.pop()},{}],MapSystem:[function(e,t,n){"use strict";cc._RF.push(t,"8bbffFETblAdIjUgquZHlvb","MapSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../sharedComponent/MapDataComponent"),a=e("../../struct/MapCeil"),i=e("../component/MapCeilComponent"),s=e("../../tools/GloableConstantUtils"),c=e("../../tools/GloableUtils"),r=e("../../manager/ResourcesManager"),l=e("../../logic/map/MapCeilUIComponent"),u=e("../utility/EcsUtility"),p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.OnUpdate=function(){this.UpdateCeilsPosition(),this.DealServerData(),this.UpdateCeilsTexture()},t}return __extends(t,e),t.prototype.OnStart=function(){ECS.World.active.EntitisManager.addSharedComponent(o.default),o.default.instance.centerPositionDirty=!1,o.default.instance.viewWidth=Math.ceil(cc.Canvas.instance.node.width/u.EcsUtility.LogicToUIRatio),o.default.instance.viewHeight=Math.ceil(cc.Canvas.instance.node.height/u.EcsUtility.LogicToUIRatio),this.InitCeilsPosition()},t.prototype.OnDestroy=function(){ECS.World.active.EntitisManager.removeSharedComponent(o.default)},t.prototype.DealServerData=function(){var e=o.default.instance.ceilsFromServer;if(e.length>0){for(var t=0;t<e.length;t++)o.default.instance.ceilsData[e[t].Position.Item1]||(o.default.instance.ceilsData[e[t].Position.Item1]=[]),o.default.instance.ceilsData[e[t].Position.Item1][e[t].Position.Item2]=e[t].Terrain;o.default.instance.ceilsFromServer=new Array}},t.prototype.InitCeilsPosition=function(){for(var e=o.default.instance.cacheWidth,t=o.default.instance.cacheHeight,n=ECS.World.active.EntitisManager,c=0;c<e;c++)for(var u=function(e){var t=n.CreateAEntity();n.addComponent(t,i.default);var o=n.GetComponent(t,i.default);o.pos=new cc.Vec2(c,e),o.ceil=new a.default,r.ResourcesManager.Instance.loadRes(s.GloableConstantUtils.GamePrefabPath.concat("Ceil"),function(e,t){var n=cc.instantiate(t);n.setParent(cc.Canvas.instance.node),n.zIndex=s.GloableConstantUtils.mapZIndex,n.getComponent(l.default).mapCeil=o,o.uiNode=n}),o.dirty=!0},p=0;p<t;p++)u(p);o.default.instance.ceilsPosistionInied=!0},t.prototype.UpdateCeilsPosition=function(){if(0!=o.default.instance.ceilsPosistionInied&&0!=o.default.instance.centerPositionDirty){for(var e=o.default.instance.cacheHeight,t=o.default.instance.cacheWidth,n=o.default.instance.centerPosition,a=n.y+e/2,i=n.y-e/2,s=n.x-t/2,c=n.x+t/2,r=n.y+o.default.instance.viewHeight/2+.5,l=n.y-o.default.instance.viewHeight/2-.5,u=n.x-o.default.instance.viewWidth/2-.5,p=n.x+o.default.instance.viewWidth/2+.5,d=(new Array,0);d<this.ceils.length;d++)this.ceils[d].pos.y>a&&(this.ceils[d].pos.y=i+(this.ceils[d].pos.y-a)%e,this.ceils[d].dirty=!0),this.ceils[d].pos.y<i&&(this.ceils[d].pos.y=a-(i-this.ceils[d].pos.y)%e,this.ceils[d].dirty=!0),this.ceils[d].pos.x>c&&(this.ceils[d].pos.x=s+(this.ceils[d].pos.x-c)%t,this.ceils[d].dirty=!0),this.ceils[d].pos.x<s&&(this.ceils[d].pos.x=c-(s-this.ceils[d].pos.x)%t,this.ceils[d].dirty=!0),1==this.ceils[d].dirty&&(this.ceils[d].inView=this.ceils[d].pos.x<p&&this.ceils[d].pos.x>u&&this.ceils[d].pos.y<r&&this.ceils[d].pos.y>l);o.default.instance.centerPositionDirty=!1}},t.prototype.UpdateCeilsTexture=function(){for(var e=0;e<this.ceils.length;e++)if(this.ceils[e].inView&&this.ceils[e].dirty&&this.ceils[e].uiNode){this.ceils[e].uiNode.active=!0;var t=Math.round(this.ceils[e].pos.x),n=Math.round(this.ceils[e].pos.y),a=0,i=[0,0,0,0,0,0,0,0];try{var s=o.default.instance.ceilsData;a=s[t][n];for(var r=0;r<8;r++)i[r]=s[t+c.GloableUtils.dx[r]][n+c.GloableUtils.dy[r]]}catch(e){Logger.info(e),Logger.error("\u5730\u5f62\u4fe1\u606f\u83b7\u53d6\u5931\u8d25\uff01("+t+", "+n+")","MAPSYS")}this.ceils[e].dirty=!1,this.ceils[e].uiDirty=this.ceils[e].ceil.Reset(a,i)}},__decorate([ECS.inject(i.default)],t.prototype,"ceils",void 0),t}(ECS.ComponentSystem);n.default=p,cc._RF.pop()},{"../../logic/map/MapCeilUIComponent":"MapCeilUIComponent","../../manager/ResourcesManager":"ResourcesManager","../../struct/MapCeil":"MapCeil","../../tools/GloableConstantUtils":"GloableConstantUtils","../../tools/GloableUtils":"GloableUtils","../component/MapCeilComponent":"MapCeilComponent","../sharedComponent/MapDataComponent":"MapDataComponent","../utility/EcsUtility":"EcsUtility"}],MotionComponent:[function(e,t,n){"use strict";cc._RF.push(t,"5bf6dBXUwJODael5B4XLnHS","MotionComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){this.speed=0,this.v=cc.Vec2.ZERO,this.canMove=!0}}();n.default=o,cc._RF.pop()},{}],MotionControllerComponent:[function(e,t,n){"use strict";cc._RF.push(t,"2399ficJ/ND6rAbOPK8mAYG","MotionControllerComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){this.type=0}}();n.default=o,cc._RF.pop()},{}],MotionControllerSystem:[function(e,t,n){"use strict";cc._RF.push(t,"cf442wmMO9PZLculpsZ+qy/","MotionControllerSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../component/MotionComponent"),a=e("../component/DirectionComponent"),i=e("../sharedComponent/InputData"),s=e("../component/MotionControllerComponent"),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.OnUpdate=function(){if(null!=this.entities)for(var e=i.default.instance,t=0;t<this.entities.length;t++)1==this.motions[t].canMove&&(this.motionController[t].type,this.directions[t].direction=cc.Vec2.ZERO,e.right&&(this.directions[t].direction.x+=1),e.left&&(this.directions[t].direction.x-=1),e.up&&(this.directions[t].direction.y+=1),e.down&&(this.directions[t].direction.y-=1),this.directions[t].direction.normalizeSelf(),this.motions[t].v=this.directions[t].direction.mul(this.motions[t].speed))},t}return __extends(t,e),__decorate([ECS.inject(a.default)],t.prototype,"directions",void 0),__decorate([ECS.inject(o.default)],t.prototype,"motions",void 0),__decorate([ECS.inject(s.default)],t.prototype,"motionController",void 0),t}(ECS.ComponentSystem);n.default=c,cc._RF.pop()},{"../component/DirectionComponent":"DirectionComponent","../component/MotionComponent":"MotionComponent","../component/MotionControllerComponent":"MotionControllerComponent","../sharedComponent/InputData":"InputData"}],MovementTest:[function(e,t,n){"use strict";cc._RF.push(t,"27e3d7+AHdIboJqy5Na1SoR","MovementTest"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,i=(o.property,function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.speed=1,t}var n;return __extends(t,e),n=t,t.prototype.start=function(){return __awaiter(this,void 0,void 0,function(){var e,t,o,a,i=this;return __generator(this,function(s){switch(s.label){case 0:return this.node.position=cc.Vec2.ZERO,e=!1,Logger.log("start","MovementTest"),this.pressing_w=!1,this.pressing_a=!1,this.pressing_s=!1,this.pressing_d=!1,(t=new SimCivil.Contract.CreateRoleOption).Gender=SimCivil.Contract.Gender.male,t.Name="jyk",t.Race=SimCivil.Contract.Race.human,[4,SimCivil.Contract.IRoleManager.CreateRole(t)];case 1:return 1==s.sent()?Logger.log("CreateRole success\uff01","MovementTest"):Logger.log("CreateRole faild","MovementTest"),a=(o=SimCivil.Contract.IRoleManager).UseRole,[4,SimCivil.Contract.IRoleManager.GetRoleList()];case 2:return[4,a.apply(o,[s.sent()[0].Id])];case 3:return 1!=s.sent()?[3,5]:(Logger.log("UseRole success\uff01","MovementTest"),[4,SimCivil.Contract.IViewSynchronizer.RegisterViewSync(function(t){t=t,0==e&&(i.node.position=i.serverPosToUIPos(new cc.Vec2(t.Position[0],t.Position[1])),e=!0,i.schedule(function(){return i.logicUpdate()},n.deltaTimePreFrame)),Logger.info(t)})]);case 4:return s.sent(),[3,6];case 5:Logger.log("UseRole faild","MovementTest"),s.label=6;case 6:return cc.systemEvent.on(cc.SystemEvent.EventType.KEY_DOWN,this.onKeyDown,this),cc.systemEvent.on(cc.SystemEvent.EventType.KEY_UP,this.onKeyUp,this),[2]}})})},t.prototype.logicUpdate=function(){Logger.log(this.node.position,name);var e=this.uiPosToServerPos(this.node.position);SimCivil.Contract.IPlayerController.MoveTo([e.x,e.y],TimeManager.Instance.GetCurrentServerTIme())},t.prototype.update=function(e){var t=new cc.Vec2(0,0);this.pressing_w&&t.addSelf(cc.Vec2.UP),this.pressing_a&&t.subSelf(cc.Vec2.RIGHT),this.pressing_s&&t.subSelf(cc.Vec2.UP),this.pressing_d&&t.addSelf(cc.Vec2.RIGHT),t.normalizeSelf(),this.node.position=this.node.position.add(this.serverPosToUIPos(t.mul(this.speed*e)))},t.prototype.uiPosToServerPos=function(e){return new cc.Vec2(e.x/100,e.y/100)},t.prototype.serverPosToUIPos=function(e){return e.mul(100)},t.prototype.onKeyDown=function(e){switch(e.keyCode){case cc.macro.KEY.w:this.pressing_w=!0;break;case cc.macro.KEY.a:this.pressing_a=!0;break;case cc.macro.KEY.s:this.pressing_s=!0;break;case cc.macro.KEY.d:this.pressing_d=!0}},t.prototype.onKeyUp=function(e){switch(e.keyCode){case cc.macro.KEY.w:this.pressing_w=!1;break;case cc.macro.KEY.a:this.pressing_a=!1;break;case cc.macro.KEY.s:this.pressing_s=!1;break;case cc.macro.KEY.d:this.pressing_d=!1}},t.deltaTimePreFrame=1,t=n=__decorate([a],t)}(cc.Component));n.default=i,cc._RF.pop()},{}],NpcAssetsData:[function(e,t,n){"use strict";cc._RF.push(t,"d8eba8rDjFB15a2OqeOqiSu","NpcAssetsData"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){this.npcAssetsDict={}}}();n.default=o,cc._RF.pop()},{}],NpcAssets:[function(e,t,n){"use strict";cc._RF.push(t,"3051am6RqhPSoFj48lJ15Ot","NpcAssets"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../enum/NpcTypeEnum"),a=function(){return function(e,t,n){void 0===n&&(n=o.NpcTypeEnum.npc),this.guid=t,this.entity=e,this.npcType=n,this.inspect=null,this.roleSummary=null}}();n.default=a,cc._RF.pop()},{"../enum/NpcTypeEnum":"NpcTypeEnum"}],NpcBehaviour:[function(e,t,n){"use strict";cc._RF.push(t,"33653pahkZAG59WzBBxojNk","NpcBehaviour"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../component/PositionComponent"),a=e("../component/NpcComponent"),i=e("../component/HealthComponent"),s=e("../../manager/ResourcesManager"),c=e("../../tools/GloableConstantUtils"),r=e("../component/GraphicComponent"),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.OnUpdate=function(){},t}return __extends(t,e),t.prototype.OnStart=function(){var e=this;Logger.log("Create:"+this.npc.npcAssets.roleSummary.Name,"NPC"),__awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=this.npc.npcAssets,[4,SimCivil.Contract.IPlayerController.Inspect(this.npc.npcAssets.guid)];case 1:return e.inspect=t.sent(),Logger.info(this.npc.npcAssets.inspect),[2]}})});var t=ECS.World.active.EntitisManager.GetComponent(this.Entity,r.default);s.ResourcesManager.Instance.loadRes(c.GloableConstantUtils.GamePrefabPath.concat("Player"),function(e,n){if(e)Logger.log(e.message);else{var o=cc.instantiate(n);o.setParent(cc.Canvas.instance.node),t.node=o}})},__decorate([ECS.inject(o.default)],t.prototype,"position",void 0),__decorate([ECS.inject(a.default)],t.prototype,"npc",void 0),__decorate([ECS.inject(i.default)],t.prototype,"health",void 0),t}(ECS.ComponentBehaviour);n.default=l,cc._RF.pop()},{"../../manager/ResourcesManager":"ResourcesManager","../../tools/GloableConstantUtils":"GloableConstantUtils","../component/GraphicComponent":"GraphicComponent","../component/HealthComponent":"HealthComponent","../component/NpcComponent":"NpcComponent","../component/PositionComponent":"PositionComponent"}],NpcComponent:[function(e,t,n){"use strict";cc._RF.push(t,"bde8eOlruxHAI8wzVxskqH0","NpcComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],NpcTypeEnum:[function(e,t,n){"use strict";cc._RF.push(t,"355ebsu6H9NAohd5J8nl5Wz","NpcTypeEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.player=0]="player",e[e.olPlayer=1]="olPlayer",e[e.npc=2]="npc"}(n.NpcTypeEnum||(n.NpcTypeEnum={})),cc._RF.pop()},{}],Npc:[function(e,t,n){"use strict";cc._RF.push(t,"877cfTRpQdD9LCJAMhiG5Tu","Npc"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,i=(o.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),Object.defineProperty(t.prototype,"entity",{get:function(){return this._entity},enumerable:!0,configurable:!0}),t=__decorate([a],t)}(cc.Component));n.default=i,cc._RF.pop()},{}],PlayerAssetsData:[function(e,t,n){"use strict";cc._RF.push(t,"51b1bBmmPJC+qkfKbvT5agj","PlayerAssetsData"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],PlayerMotionSyncSystem:[function(e,t,n){"use strict";cc._RF.push(t,"20cfalIhZVA1Zlq+cA8Vt0z","PlayerMotionSyncSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../component/MotionComponent"),a=e("../component/MotionControllerComponent"),i=e("../component/PositionComponent"),s=e("../utility/EcsUtility"),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.OnUpdate=function(){for(var e=TimeManager.Instance.GetCurrentServerTIme(),t=0;t<this.motion.length;t++)if(this.motion[t].v.magSqr()>0){var n=this.motion[t].v.mul((e-s.EcsUtility.LastLocalMoveTime)/1e3);s.EcsUtility.LastLocalMoveTime=e,this.pos[t].position=this.pos[t].position.add(n),e-s.EcsUtility.LastSyncMotionTime>s.EcsUtility.SyncPositionDeltaTime&&(SimCivil.Contract.IPlayerController.MoveTo([this.pos[t].position.x,this.pos[t].position.y],e),s.EcsUtility.LastSyncMotionTime=e)}else s.EcsUtility.LastLocalMoveTime=e},t}return __extends(t,e),t.prototype.OnStart=function(){s.EcsUtility.LastLocalMoveTime=s.EcsUtility.LastSyncMotionTime=TimeManager.Instance.GetCurrentServerTIme()},__decorate([ECS.inject(i.default)],t.prototype,"pos",void 0),__decorate([ECS.inject(o.default)],t.prototype,"motion",void 0),__decorate([ECS.inject(a.default)],t.prototype,"controller",void 0),t}(ECS.ComponentSystem);n.default=c,cc._RF.pop()},{"../component/MotionComponent":"MotionComponent","../component/MotionControllerComponent":"MotionControllerComponent","../component/PositionComponent":"PositionComponent","../utility/EcsUtility":"EcsUtility"}],Player:[function(e,t,n){"use strict";cc._RF.push(t,"d44576A8VpP97b9YORzMgN7","Player"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./Npc"),a=e("./Avatar"),i=cc._decorator,s=i.ccclass,c=(i.property,function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.start=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.avatar=new a.default(this.node),[4,this.avatar.load()];case 1:return e.sent(),[2]}})})},t=__decorate([s],t)}(o.default));n.default=c,cc._RF.pop()},{"./Avatar":"Avatar","./Npc":"Npc"}],PopUpCreateRoleUI:[function(e,t,n){"use strict";cc._RF.push(t,"56454fIDB5O/KsEPBXgJGSW","PopUpCreateRoleUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../UIBase"),a=e("../../manager/UI2EcsSessionManager"),i=e("../../struct/UIProto"),s=e("../../enum/UIProtoTypeEnum"),c=e("../../manager/UIManager"),r=e("../../enum/UINameEnum"),l=cc._decorator,u=l.ccclass,p=l.property,d=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return __extends(t,e),t.prototype.show=function(){},t.prototype.hide=function(){UIAnimationUtils.ScaleOut(this.node)},t.prototype.onLoad=function(){this.gender=SimCivil.Contract.Gender.male,this.race=SimCivil.Contract.Race.human},t.prototype.SetGender=function(e){switch(e){case"male":this.gender=SimCivil.Contract.Gender.male;break;case"female":this.gender=SimCivil.Contract.Gender.female;break;case"other":this.gender=SimCivil.Contract.Gender.other;break;case"none":this.gender=SimCivil.Contract.Gender.none}},t.prototype.SetRace=function(e){switch(e){case"human":this.race=SimCivil.Contract.Race.human}},t.prototype.OnClickSure=function(){if(""!=this.NameEditLabel.string){var e=new SimCivil.Contract.CreateRoleOption;e.Gender=this.gender,e.Race=this.race,e.Name=this.NameEditLabel.string,Logger.info(e),a.UI2EcsSessionManager.Instance.Send(new i.default(s.UIProtoTypeEnum.REQ_CREATE_ROLE,e)),c.UIManager.Instance.HideUI(r.UINameEnum.POP_UP_CREATE_ROLE_UI)}},__decorate([p(cc.EditBox)],t.prototype,"NameEditLabel",void 0),t=__decorate([u],t)}(o.default);n.PopUpCreateRoleUI=d,cc._RF.pop()},{"../../enum/UINameEnum":"UINameEnum","../../enum/UIProtoTypeEnum":"UIProtoTypeEnum","../../manager/UI2EcsSessionManager":"UI2EcsSessionManager","../../manager/UIManager":"UIManager","../../struct/UIProto":"UIProto","../UIBase":"UIBase"}],PopupWarningUI:[function(e,t,n){"use strict";cc._RF.push(t,"1d5923CL8ZOPIyPH1il1aeS","PopupWarningUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("./UIBase"),a=e("../tools/GloableUtils"),i=cc._decorator,s=i.ccclass,c=i.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.text=null,t}return __extends(t,e),t.prototype.hide=function(){UIAnimationUtils.ScaleOut(this.node)},t.prototype.show=function(){UIAnimationUtils.ScaleIn(this.node)},t.prototype.clickOk=function(){a.GloableUtils.TipsOnclickOk()},t.prototype.clickCancel=function(){a.GloableUtils.TipsOnclickCancel()},__decorate([c(cc.Label)],t.prototype,"text",void 0),t=__decorate([s],t)}(o.default);n.default=r,cc._RF.pop()},{"../tools/GloableUtils":"GloableUtils","./UIBase":"UIBase"}],PositionComponent:[function(e,t,n){"use strict";cc._RF.push(t,"b75ecH6AD5P27gQ7Re/Kq5B","PositionComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){function e(){this._position=cc.Vec2.ZERO,this._dirty=!0}return Object.defineProperty(e.prototype,"position",{get:function(){return this._position},set:function(e){e!=this._position&&(this._position=e,this._dirty=!0)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dirty",{get:function(){return this._dirty},set:function(e){this._dirty=e},enumerable:!0,configurable:!0}),e}();n.default=o,cc._RF.pop()},{}],PositionSTGSystem:[function(e,t,n){"use strict";cc._RF.push(t,"a97dfHWKm9BS4FHfDhsrJQx","PositionSTGSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../component/PositionComponent"),a=e("../component/GraphicComponent"),i=e("../utility/EcsUtility"),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.OnUpdate=function(){if(this.pos)for(var e=0;e<this.pos.length;e++)1==this.pos[e].dirty&&this.graphic[e].node&&(this.graphic[e].node.position=this.pos[e].position.mul(i.EcsUtility.LogicToUIRatio),this.pos[e].dirty=!1,Logger.log(this.pos[e].position,"POS"))},t}return __extends(t,e),__decorate([ECS.inject(o.default)],t.prototype,"pos",void 0),__decorate([ECS.inject(a.default)],t.prototype,"graphic",void 0),t}(ECS.ComponentSystem);n.default=s,cc._RF.pop()},{"../component/GraphicComponent":"GraphicComponent","../component/PositionComponent":"PositionComponent","../utility/EcsUtility":"EcsUtility"}],ResourcesManager:[function(e,t,n){"use strict";cc._RF.push(t,"381adfWfv1FV7Exm6dQCyL7","ResourcesManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../tools/GloableConstantUtils"),a=function(){function e(){this.atlasMap=new Array}return e.prototype.Init=function(){},e.prototype.loadRes=function(e,t){cc.loader.loadRes(e,t)},e.prototype.loadAtlas=function(e,t){var n=this;this.atlasMap[e]?t(null,this.atlasMap[e]):cc.loader.loadRes(o.GloableConstantUtils.AtlasPath.concat(e),cc.SpriteAtlas,function(o,a){o||(n.atlasMap[e]=a,a.getTexture().setFilters(cc.Texture2D.Filter.NEAREST,cc.Texture2D.Filter.NEAREST)),t(o,a)})},e.Instance=new e,e}();n.ResourcesManager=a,cc._RF.pop()},{"../tools/GloableConstantUtils":"GloableConstantUtils"}],RolesSystem:[function(e,t,n){"use strict";cc._RF.push(t,"7611e01HXdN956/Xyo4Rv1b","RolesSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../sharedComponent/PlayerAssetsData"),a=e("../sharedComponent/UISessionDate"),i=e("../../struct/UIProto"),s=e("../../enum/UIProtoTypeEnum"),c=e("../../manager/LocalizationManager"),r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.OnUpdate=function(){if(a.default.instance.UI2ECSProtos.count>0&&a.default.instance.UI2ECSProtos.first.type==s.UIProtoTypeEnum.REQ_CREATE_ROLE){var e=a.default.instance.UI2ECSProtos.Dequeue().params[0];Logger.info(e),this.CeateRole(e)}},t}return __extends(t,e),t.prototype.OnStart=function(){var e=this;ECS.World.active.EntitisManager.addSharedComponent(o.default),__awaiter(e,void 0,void 0,function(){var e;return __generator(this,function(t){switch(t.label){case 0:return e=o.default.instance,[4,SimCivil.Contract.IRoleManager.GetRoleList()];case 1:return e.Roles=t.sent(),a.default.instance.ECS2UIProtos.Enqueue(new i.default(s.UIProtoTypeEnum.RLT_ROLES,o.default.instance.Roles)),[2]}})})},t.prototype.OnDestroy=function(){ECS.World.active.EntitisManager.removeSharedComponent(o.default)},t.prototype.CeateRole=function(e){return __awaiter(this,void 0,Promise,function(){var t;return __generator(this,function(n){switch(n.label){case 0:return[4,SimCivil.Contract.IRoleManager.CreateRole(e)];case 1:return n.sent()?(t=o.default.instance,[4,SimCivil.Contract.IRoleManager.GetRoleList()]):[3,3];case 2:return t.Roles=n.sent(),a.default.instance.ECS2UIProtos.Enqueue(new i.default(s.UIProtoTypeEnum.RLT_ROLES,o.default.instance.Roles)),[3,4];case 3:a.default.instance.ECS2UIProtos.Enqueue(new i.default(s.UIProtoTypeEnum.RLT_ERROR_EVENT,c.LocalizationManager.Instance.GetLocalizationTextByKey("create_role_error"))),n.label=4;case 4:return[2]}})})},t}(ECS.ComponentSystem);n.default=r,cc._RF.pop()},{"../../enum/UIProtoTypeEnum":"UIProtoTypeEnum","../../manager/LocalizationManager":"LocalizationManager","../../struct/UIProto":"UIProto","../sharedComponent/PlayerAssetsData":"PlayerAssetsData","../sharedComponent/UISessionDate":"UISessionDate"}],SceneEnum:[function(e,t,n){"use strict";cc._RF.push(t,"1af1a1KMtlBQa2+1bCV/U41","SceneEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.MAIN="main",e.LAUNCHER="launcher"}(n.SceneEnum||(n.SceneEnum={})),cc._RF.pop()},{}],ServerArrObject:[function(e,t,n){"use strict";cc._RF.push(t,"daad95uQSFO/75/4JgMEMsH","ServerArrObject"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],SizeComponent:[function(e,t,n){"use strict";cc._RF.push(t,"fa573VRhLNGvKipxojDfY9p","SizeComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],StateEnum:[function(e,t,n){"use strict";cc._RF.push(t,"29b9ctEixBAKr6iH86UBQPJ","StateEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.GAME_STATE_LOGIN=0]="GAME_STATE_LOGIN",e[e.GAME_STATE_SCENE_LOADING=1]="GAME_STATE_SCENE_LOADING",e[e.GAME_STATE_MAIN_NORMAL=2]="GAME_STATE_MAIN_NORMAL"}(n.GameStateEnum||(n.GameStateEnum={})),cc._RF.pop()},{}],TestComponent2:[function(e,t,n){"use strict";cc._RF.push(t,"590141a2TBEg70CSjc1E2yo","TestComponent2"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],TestComponent:[function(e,t,n){"use strict";cc._RF.push(t,"7399cBpIRFIm6N7HcUAe0YN","TestComponent"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],Test:[function(e,t,n){"use strict";cc._RF.push(t,"227b9/g0u5Pq48hMJ9vMq3R","Test"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,i=o.property,s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.db=null,t}return __extends(t,e),t.prototype.start=function(){Logger.info(this.db.dragonAsset),Logger.info(this.db.dragonAtlasAsset);var e=this.db.armature();Logger.info(e);e.getSlot("legR");Logger.info(e.display)},__decorate([i(dragonBones.ArmatureDisplay)],t.prototype,"db",void 0),t=__decorate([a],t)}(cc.Component);n.default=s,cc._RF.pop()},{}],TextLocalization:[function(e,t,n){"use strict";cc._RF.push(t,"80575NOVc1KPLH+qkR9bE9+","TextLocalization"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../enum/EventEnum"),a=e("../manager/LocalizationManager"),i=cc._decorator,s=i.ccclass,c=i.property,r=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="",t.text=null,t}return __extends(t,e),t.prototype.onLoad=function(){this.text=this.node.getComponent(cc.Label),null==this.text&&(this.text=this.node.getComponent(cc.RichText)),null==this.text&&(this.text=this.node.getComponent(cc.EditBox)),this.refreshLocalization(),this.node.on(o.EventEnum.RefreshLocalizationText,this.refreshLocalization)},t.prototype.onDestroy=function(){this.node.off(o.EventEnum.RefreshLocalizationText,this.refreshLocalization)},t.prototype.refreshLocalization=function(){null!=this.text&&(this.text instanceof cc.EditBox?this.text.placeholder=a.LocalizationManager.Instance.GetLocalizationTextByKey(this.key):this.text.string=a.LocalizationManager.Instance.GetLocalizationTextByKey(this.key))},__decorate([c],t.prototype,"key",void 0),t=__decorate([s],t)}(cc.Component);n.default=r,cc._RF.pop()},{"../enum/EventEnum":"EventEnum","../manager/LocalizationManager":"LocalizationManager"}],UI2EcsSessionManager:[function(e,t,n){"use strict";cc._RF.push(t,"048fe6i6yhCXr5qnXdLxu+r","UI2EcsSessionManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../ecs/sharedComponent/UISessionDate"),a=e("../enum/UIProtoTypeEnum"),i=e("./UIManager"),s=e("../enum/UINameEnum"),c=e("../tools/GloableUtils"),r=function(){function e(){}return e.prototype.Init=function(){},e.prototype.Send=function(e){o.default.instance.UI2ECSProtos.Enqueue(e)},e.prototype.Update=function(e){for(;o.default.instance.ECS2UIProtos.count>0;){var t=o.default.instance.ECS2UIProtos.Dequeue();switch(t.type){case a.UIProtoTypeEnum.RLT_ROLES:this.RltGetRoles(t);break;case a.UIProtoTypeEnum.RLT_ERROR_EVENT:c.GloableUtils.ShowTips(t.params[0])}}},e.prototype.RltGetRoles=function(e){i.UIManager.Instance.GetUI(s.UINameEnum.CHOOSE_ROLE_UI).Refresh(e.params[0])},e.Instance=new e,e}();n.UI2EcsSessionManager=r,cc._RF.pop()},{"../ecs/sharedComponent/UISessionDate":"UISessionDate","../enum/UINameEnum":"UINameEnum","../enum/UIProtoTypeEnum":"UIProtoTypeEnum","../tools/GloableUtils":"GloableUtils","./UIManager":"UIManager"}],UIAnimationUtils:[function(e,t,n){"use strict";cc._RF.push(t,"8611ciZCwBIxIdzCwicxPyd","UIAnimationUtils");(function(){function e(){}e.ScaleIn=function(e,t,n,o){void 0===n&&(n=0),void 0===o&&(o=1),e.active=!0,e.scale=n,e.stopAllActions();var a=cc.scaleTo(.5,o).easing(cc.easeBackOut());if(void 0!=t&&null!=t){var i=cc.sequence(a,cc.callFunc(t));e.runAction(i)}else e.runAction(a)},e.ScaleOut=function(e,t,n,o){void 0===n&&(n=1),void 0===o&&(o=0),e.scale=n,e.stopAllActions();var a=cc.scaleTo(.5,o).easing(cc.easeBackIn()),i=cc.sequence(a,cc.callFunc(function(){e.active=!1,void 0!=t&&null!=t&&t()}));e.runAction(i)},e.MoveIn=function(e,t,n,o){void 0===n&&(n=cc.Vec2.ZERO),void 0===o&&(o=null),e.active=!0,null!=o&&(e.position=o),e.stopAllActions();var a=cc.moveTo(1,n).easing(cc.easeBackOut());if(void 0!=t&&null!=t){var i=cc.sequence(a,cc.callFunc(t));e.runAction(i)}else e.runAction(a)},e.MoveOut=function(e,t,n,o){void 0===n&&(n=cc.Vec2.ZERO),void 0===o&&(o=null),null!=o&&(e.position=o),e.stopAllActions();var a=cc.moveTo(1,n).easing(cc.easeBackIn()),i=cc.sequence(a,cc.callFunc(function(){e.active=!1,void 0!=t&&null!=t&&t()}));e.runAction(i)}})();cc._RF.pop()},{}],UIBase:[function(e,t,n){"use strict";cc._RF.push(t,"49e920GPCZCLbsZZhLVQ7R6","UIBase"),Object.defineProperty(n,"__esModule",{value:!0});var o=cc._decorator,a=o.ccclass,i=o.property,s=o.disallowMultiple,c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.zIndex=0,t}return __extends(t,e),t.prototype.init=function(){this.node.zIndex=this.zIndex},t.prototype.hide=function(){},t.prototype.show=function(){},__decorate([i()],t.prototype,"zIndex",void 0),t=__decorate([a,s],t)}(cc.Component);n.default=c,cc._RF.pop()},{}],UIManager:[function(e,t,n){"use strict";cc._RF.push(t,"6687doIZMNNgJj1UjL9Qlh0","UIManager"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../tools/GloableConstantUtils"),a=e("./ResourcesManager"),i=function(){function e(){}return Object.defineProperty(e.prototype,"Canvas",{get:function(){return this.canvas},enumerable:!0,configurable:!0}),e.prototype.Init=function(){this.canvas=cc.Canvas.instance,this.uiDictionary=new Array},e.prototype.ShowUI=function(e,t,n){var i=this;void 0===t&&(t=null),void 0===n&&(n=this.canvas.node),Logger.log("ShowUI "+e,"UIManager"),void 0==this.uiDictionary[e]?(this.uiDictionary[e]=null,a.ResourcesManager.Instance.loadRes(o.GloableConstantUtils.UIPrefabPath.concat(e),function(o,a){if(null==o){var s=cc.instantiate(a);i.uiDictionary[e]=s.getComponent(e),s.parent=n,null==i.uiDictionary[e]?(Logger.error('Get null component from the ui named "'+e+'"',"UIManager"),null!=t&&t(new Error('Get null component from the ui named "'+e+'"'),null)):(i.uiDictionary[e].init(),i.uiDictionary[e].show(),null!=t&&t(null,i.uiDictionary[e]))}else null!=t&&t(o,null)})):null==this.uiDictionary[e]?(Logger.error('There are many places attempt to show the same UI "'+e+'"',"UIManager"),null!=t&&t(new Error('There are many places attempt to show the same UI "'+e+'"'),null)):(this.uiDictionary[e].show(),null!=t&&t(null,this.uiDictionary[e]))},e.prototype.HideUI=function(e){Logger.log("HideUI "+e,"UIManager"),void 0!=this.uiDictionary[e]&&null!=this.uiDictionary[e]&&this.uiDictionary[e].hide()},e.prototype.GetUI=function(e){return this.uiDictionary[e]},e.prototype.DestroyUI=function(e){void 0!=this.uiDictionary[e]&&1==cc.isValid(this.uiDictionary[e])&&(this.uiDictionary[e].node.destroy(),this.uiDictionary[e]=void 0)},e.prototype.DestroyAll=function(){for(;this.uiDictionary.length>0;){var e=this.uiDictionary.pop();null!=e&&void 0!=e&&e.node.destroy()}cc.loader.releaseAll()},e.Instance=new e,e}();n.UIManager=i,cc._RF.pop()},{"../tools/GloableConstantUtils":"GloableConstantUtils","./ResourcesManager":"ResourcesManager"}],UINameEnum:[function(e,t,n){"use strict";cc._RF.push(t,"e14066hHE9EwJUA9LGMMG2V","UINameEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e.LOGIN_UI="LoginUI",e.LOADING_UI="LoadingUI",e.POP_UP_WARNING_UI="PopupWarningUI",e.MAIN_UI="MainUI",e.MAIN_UI_EQUIP_COMPONENT="MainUIEquipComponent",e.EDITE_UI="EditUI",e.DEFAULT="null",e.CHOOSE_ROLE_UI="ChooseRoleUI",e.CHOOSE_ROLE_UI_COMPONENT="ChooseRoleUIComponent",e.POP_UP_CREATE_ROLE_UI="PopUpCreateRoleUI",e.USER_INFO_UI="UserInfoUI"}(n.UINameEnum||(n.UINameEnum={})),cc._RF.pop()},{}],UIProtoTypeEnum:[function(e,t,n){"use strict";cc._RF.push(t,"85d87ANWo5CgJ2nk0+JMYp4","UIProtoTypeEnum"),Object.defineProperty(n,"__esModule",{value:!0}),function(e){e[e.REQ_LOGIN=0]="REQ_LOGIN",e[e.RLT_ROLES=1]="RLT_ROLES",e[e.REQ_CREATE_ROLE=2]="REQ_CREATE_ROLE",e[e.REQ_CHOOSE_ROLE=3]="REQ_CHOOSE_ROLE",e[e.RLT_ERROR_EVENT=4]="RLT_ERROR_EVENT"}(n.UIProtoTypeEnum||(n.UIProtoTypeEnum={})),cc._RF.pop()},{}],UIProto:[function(e,t,n){"use strict";cc._RF.push(t,"0ba82588fVEkIrhoIW2XSSo","UIProto"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.type=e,this.date=TimeManager.Instance.GetDateTime(),this.time=TimeManager.Instance.realTimeSinceStartScene,this.params=t}}();n.default=o,cc._RF.pop()},{}],UISessionDate:[function(e,t,n){"use strict";cc._RF.push(t,"36c80BzXJ5Bg5WpTJcZUwLk","UISessionDate"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){this.ECS2UIProtos=new Tools.Queue,this.UI2ECSProtos=new Tools.Queue}}();n.default=o,cc._RF.pop()},{}],UserInfoUI:[function(e,t,n){"use strict";cc._RF.push(t,"c2672Yy9OtJcZjibJk+oRMZ","UserInfoUI"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../UIBase"),a=e("../../ecs/sharedComponent/PlayerAssetsData"),i=e("./AttriDispComponentUI"),s=e("../../manager/ResourcesManager"),c=e("../../tools/GloableConstantUtils"),r=e("../../enum/AbilityIndex"),l=e("../../enum/EffectIndex"),u=e("../../enum/BodyPartIndex"),p=cc._decorator,d=p.ccclass,m=p.property,f=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.abilityComponents=new Array,t.effectComponents=new Array,t.bodyPartComponents=new Array,t}return __extends(t,e),t.prototype.show=function(){var e=this;if(UIAnimationUtils.ScaleIn(this.node),a.default.instance.npcAssets&&a.default.instance.npcAssets.inspect){var t=a.default.instance.npcAssets.inspect;s.ResourcesManager.Instance.loadRes(c.GloableConstantUtils.UIPrefabPath+"AttriDispComponentUI",function(n,o){if(null!=t.Values.Abilities&&void 0!=t.Values.Abilities)for(var a=0;a<t.Values.Abilities.$values.length;a++){if(e.abilityComponents.length<=a){var s=cc.instantiate(o);e.abilityComponents.push(s.getComponent(i.default))}e.abilityComponents[a].node.setParent(e.AbilityCompNode),e.abilityComponents[a].SetValue(r.AbilityIndex[a],t.Values.Abilities.$values[a].Value.toString())}if(null!=t.Values.Effects&&void 0!=t.Values.Effects)for(a=0;a<t.Values.Effects.$values.length;a++){if(e.effectComponents.length<=a){s=cc.instantiate(o);e.effectComponents.push(s.getComponent(i.default))}e.effectComponents[a].node.setParent(e.EffectCompNode),e.effectComponents[a].SetValue(l.EffectIndex[a],t.Values.Effects.$values[a].Value.toString())}if(null!=t.Values.BodyParts&&void 0!=t.Values.BodyParts)for(a=0;a<t.Values.BodyParts.$values.length;a++){if(e.bodyPartComponents.length<=a){s=cc.instantiate(o);e.bodyPartComponents.push(s.getComponent(i.default))}e.bodyPartComponents[a].node.setParent(e.BodyPartNode),e.bodyPartComponents[a].SetValue(u.BodyPartIndex[a],t.Values.BodyParts.$values[a].Hp.toString()+"("+t.Values.BodyParts.$values[a].MaxHp.toString()+")")}})}},t.prototype.hide=function(){UIAnimationUtils.ScaleOut(this.node)},__decorate([m(cc.Node)],t.prototype,"AbilityCompNode",void 0),__decorate([m(cc.Node)],t.prototype,"EffectCompNode",void 0),__decorate([m(cc.Node)],t.prototype,"BodyPartNode",void 0),t=__decorate([d],t)}(o.default);n.UserInfoUI=f,cc._RF.pop()},{"../../ecs/sharedComponent/PlayerAssetsData":"PlayerAssetsData","../../enum/AbilityIndex":"AbilityIndex","../../enum/BodyPartIndex":"BodyPartIndex","../../enum/EffectIndex":"EffectIndex","../../manager/ResourcesManager":"ResourcesManager","../../tools/GloableConstantUtils":"GloableConstantUtils","../UIBase":"UIBase","./AttriDispComponentUI":"AttriDispComponentUI"}],ViewChangeData:[function(e,t,n){"use strict";cc._RF.push(t,"5e8f650DP9Amp5HyLr9+Aib","ViewChangeData"),Object.defineProperty(n,"__esModule",{value:!0});var o=function(){return function(){}}();n.default=o,cc._RF.pop()},{}],ViewSyncSystem:[function(e,t,n){"use strict";cc._RF.push(t,"c90276XGDNDMo2wUxG02arD","ViewSyncSystem"),Object.defineProperty(n,"__esModule",{value:!0});var o=e("../utility/EcsUtility"),a=e("../sharedComponent/ViewChangeData"),i=e("../../tools/GloableUtils"),s=e("../component/PositionComponent"),c=e("../component/MotionControllerComponent"),r=e("../component/MotionComponent"),l=e("../sharedComponent/MapDataComponent"),u=e("../sharedComponent/NpcAssetsData"),p=e("../component/HealthComponent"),d=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.OnUpdate=function(){if(null!=a.default.instance.data&&null!=this.positions&&this.positions.length>0){var e=new cc.Vec2(a.default.instance.data.Position[0],a.default.instance.data.Position[1]);if(this.positions[0].position.sub(e).magSqr()>1||0==a.default.instance.gotData){if(Logger.log("\u51fa\u73b0\u5ba2\u6237\u7aef\u548c\u670d\u52a1\u5668\u4f4d\u7f6e\u4e0d\u540c\u6b65\u7684\u95ee\u9898\uff01\u5ba2\u6237\u7aef\u4f4d\u7f6e:"+this.positions[0].position+" ; \u670d\u52a1\u5668\u4f4d\u7f6e:"+e+";","ViewChange"),Logger.info(a.default.instance.data),o.EcsUtility.LastSyncMotionTime=TimeManager.Instance.GetCurrentServerTIme(),0==a.default.instance.gotData){a.default.instance.gotData=!0;var t=0;SimCivil.Contract.IViewSynchronizer.GetAtlas([0,0]).then(function(e){e&&(l.default.instance.ceilsFromServer=l.default.instance.ceilsFromServer.concat(e),9==++t&&(Logger.info("overed"),l.default.instance.centerPositionDirty=!0))});for(var n=0;n<8;n++){i.GloableUtils.dx[n],i.GloableUtils.dy[n];SimCivil.Contract.IViewSynchronizer.GetAtlas([0+i.GloableUtils.dx[n],0+i.GloableUtils.dy[n]]).then(function(e){e&&(l.default.instance.ceilsFromServer=l.default.instance.ceilsFromServer.concat(e),9==++t&&(Logger.info("overed"),l.default.instance.centerPositionDirty=!0))})}}this.positions[0].position=e,this.motions[0].speed=a.default.instance.data.Speed}}null!=a.default.instance.data&&a.default.instance.data.EntityChange.length>0&&a.default.instance.data.EntityChange.forEach(function(e){var t=u.default.instance.npcAssetsDict[e.Id],n=0;n=null==t||void 0==t?o.EcsUtility.AddNpc(e):t.entity,ECS.World.active.EntitisManager.GetComponent(n,p.default).HP=e.Hp,ECS.World.active.EntitisManager.GetComponent(n,s.default).position=cc.v2(e.Pos[0],e.Pos[1])})},t}return __extends(t,e),t.prototype.OnStart=function(){var e=this;ECS.World.active.EntitisManager.addSharedComponent(a.default),ECS.World.active.EntitisManager.addSharedComponent(u.default),a.default.instance.data=null,a.default.instance.gotData=!1,o.EcsUtility.InitedViewSyncSystem=!1,o.EcsUtility.RegisterViewSyncOpt=__awaiter(e,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return[4,SimCivil.Contract.IViewSynchronizer.RegisterViewSync(function(e){a.default.instance.data=e})];case 1:return e.sent(),o.EcsUtility.InitedViewSyncSystem=!0,[2]}})})},t.prototype.OnDestroy=function(){ECS.World.active.EntitisManager.removeSharedComponent(a.default),o.EcsUtility.InitedViewSyncSystem=!1},__decorate([ECS.inject(r.default)],t.prototype,"motions",void 0),__decorate([ECS.inject(s.default)],t.prototype,"positions",void 0),__decorate([ECS.inject(c.default)],t.prototype,"motionController",void 0),t}(ECS.ComponentSystem);n.default=d,cc._RF.pop()},{"../../tools/GloableUtils":"GloableUtils","../component/HealthComponent":"HealthComponent","../component/MotionComponent":"MotionComponent","../component/MotionControllerComponent":"MotionControllerComponent","../component/PositionComponent":"PositionComponent","../sharedComponent/MapDataComponent":"MapDataComponent","../sharedComponent/NpcAssetsData":"NpcAssetsData","../sharedComponent/ViewChangeData":"ViewChangeData","../utility/EcsUtility":"EcsUtility"}]},{},["Test","NpcBehaviour","DirectionComponent","GraphicComponent","HealthComponent","MapCeilComponent","MotionComponent","MotionControllerComponent","NpcComponent","PositionComponent","SizeComponent","TestComponent","TestComponent2","InputData","MapDataComponent","NpcAssetsData","PlayerAssetsData","UISessionDate","ViewChangeData","CameraSystem","FuncKeySystem","InputSystem","MapSystem","MotionControllerSystem","PlayerMotionSyncSystem","PositionSTGSystem","RolesSystem","ViewSyncSystem","EcsUtility","AbilityIndex","BodyPartIndex","ComponentUINameEnum","EffectIndex","EventEnum","JsonConfigNameEnum","LocalStorageEnum","MapCeilTypEnum","NpcTypeEnum","SceneEnum","StateEnum","UINameEnum","UIProtoTypeEnum","GameStateLogin","GameStateMainNormal","GameStateSceneLoading","GameLauncher","MapCeilUIComponent","Avatar","Npc","Player","EditableComponentUIManager","GameManager","LocalizationManager","ResourcesManager","UI2EcsSessionManager","UIManager","MapCeil","NpcAssets","ServerArrObject","UIProto","MovementTest","GloableConstantUtils","GloableUtils","JsonConfigUtils","TextLocalization","UIAnimationUtils","PopupWarningUI","UIBase","ChooseRoleUI","ChooseRoleUIComponent","PopUpCreateRoleUI","EditableComponentContainer","EditableComponentContainerConfigure","EditableComponentUI","EditableComponentUIConfigure","LoadingUI","LoginUI","MainUI","MainUIEquipComponent","AttriDispComponentUI","UserInfoUI"]);